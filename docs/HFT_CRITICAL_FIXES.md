# HFT æ¨¡å—å…³é”®é—®é¢˜ä¿®å¤æŠ¥å‘Š

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº† HFT æ¨¡å—åœ¨è¿è¡Œä¸­å‘ç°çš„ 3 ä¸ªå…³é”®é—®é¢˜åŠå…¶ä¿®å¤æ–¹æ¡ˆã€‚

---

## ğŸ”´ é—®é¢˜ 1ï¼šé…ç½®éªŒè¯å¤±è´¥ï¼ˆä¸¥é‡ï¼‰

### é—®é¢˜æè¿°

```
ERROR - åŠ è½½é«˜é¢‘äº¤æ˜“é…ç½®å¤±è´¥: 'order_size' å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
```

### æ ¹æœ¬åŸå› 

`config/base.json` ä¸­çš„ `order_size` æ˜¯æµ®ç‚¹æ•° `0.01`ï¼Œä½†éªŒè¯ä»£ç è¦æ±‚å¿…é¡»æ˜¯**æ­£æ•´æ•°**ã€‚

```json
// config/base.jsonï¼ˆé”™è¯¯ï¼‰
{
  "high_freq_strategies": {
    "order_size": 0.01,  // âŒ æµ®ç‚¹æ•°
    "symbol": "SOL-USDT-SWAP"  // âŒ äº¤æ˜“å¯¹é”™è¯¯
  }
}
```

```python
// src/high_frequency/config_loader.pyï¼ˆéªŒè¯ä»£ç ï¼‰
if not isinstance(validated['order_size'], int) or validated['order_size'] <= 0:
    raise ValueError("'order_size' å¿…é¡»æ˜¯æ­£æ•´æ•°")  // âŒ éªŒè¯å¤±è´¥
```

### ä¿®å¤æ–¹æ¡ˆ

ä¿®æ”¹ `config/base.json`ï¼Œå°† `order_size` æ”¹ä¸ºæ•´æ•°ï¼š

```json
{
  "high_freq_strategies": {
    "order_size": 1,  // âœ… æ•´æ•°ï¼ˆå¼ æ•°ï¼‰
    "symbol": "BTC-USDT-SWAP",  // âœ… æ­£ç¡®çš„äº¤æ˜“å¯¹
    "whale_threshold": 5000.0  // âœ… æ­£ç¡®çš„å¤§å•é˜ˆå€¼
  }
}
```

### ä¿®æ”¹æ–‡ä»¶

- âœ… `config/base.json`

### éªŒè¯ç»“æœ

```bash
python -m py_compile config/base.json
âœ… ç¼–è¯‘æˆåŠŸ
```

---

## ğŸ”´ é—®é¢˜ 2ï¼šç¯å¢ƒå˜é‡è¯»å–ä¸è¶³ï¼ˆä¸¥é‡ï¼‰

### é—®é¢˜æè¿°

```
INFO - ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®: 1 ä¸ªå‚æ•°
```

åªè¯»å–åˆ° 1 ä¸ªç¯å¢ƒå˜é‡ï¼Œåº”è¯¥è¯»å–åˆ°æ›´å¤šã€‚

### æ ¹æœ¬åŸå› 

å¤§éƒ¨åˆ† HFT é…ç½®å‚æ•°æ²¡æœ‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´é…ç½®åŠ è½½å™¨é€€å›åˆ° JSON é…ç½®æ–‡ä»¶ã€‚

### ä¿®å¤æ–¹æ¡ˆ

åˆ›å»º `.env.example` æ–‡ä»¶ï¼Œæä¾›å®Œæ•´çš„ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹ï¼š

```bash
# HFT æ¨¡å—é…ç½®
HFT_ENABLED=false
HFT_SYMBOL=BTC-USDT-SWAP
HFT_MODE=hybrid
HFT_ORDER_SIZE=1
HFT_EMA_FAST_PERIOD=9
HFT_EMA_SLOW_PERIOD=21
HFT_RISK_RATIO=0.2
HFT_LEVERAGE=10
HFT_WHALE_THRESHOLD=5000.0
# ... å…¶ä»–å‚æ•°
```

### ä½¿ç”¨æ–¹æ³•

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
   ```bash
   cp .env.example .env
   ```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®é…ç½®å‚æ•°ï¼š
   ```bash
   nano .env
   ```

3. å¯åŠ¨ç¨‹åºï¼ˆè‡ªåŠ¨åŠ è½½ `.env` æ–‡ä»¶ï¼‰ï¼š
   ```bash
   python main_hft.py
   ```

### ä¿®æ”¹æ–‡ä»¶

- âœ… `.env.example`ï¼ˆæ–°å»ºï¼‰

### é…ç½®åŠ è½½ä¼˜å…ˆçº§

```
1. ç¯å¢ƒå˜é‡ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. JSON é…ç½®æ–‡ä»¶ï¼ˆæ¬¡ä¼˜å…ˆçº§ï¼‰
3. é»˜è®¤é…ç½®ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
```

---

## ğŸ”´ é—®é¢˜ 3ï¼šAPI ç­¾åå’Œæ—¶é—´æˆ³é”™è¯¯ï¼ˆä¸¥é‡ï¼‰

### é—®é¢˜æè¿°

```
ERROR - Invalid Sign (code: 50113)
ERROR - Invalid timestamp (code: 60004)
```

### æ ¹æœ¬åŸå› 

**ç³»ç»Ÿæ—¶é—´ä¸åŒæ­¥ï¼** ä»æ—¥å¿—ä¸­çœ‹åˆ°ï¼š

```
2026-01-09T04:44:26.654Z  // âŒ æœªæ¥æ—¶é—´ï¼ˆ2026 å¹´ï¼‰
```

è¿™æ˜¯ **æœªæ¥æ—¶é—´**ï¼Œä¼šå¯¼è‡´ï¼š
1. **Invalid timestamp** - æ—¶é—´æˆ³è¶…å‡ºå…è®¸èŒƒå›´
2. **Invalid Sign** - æ—¶é—´æˆ³é”™è¯¯å¯¼è‡´ç­¾åéªŒè¯å¤±è´¥

### ä¿®å¤æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1ï¼šåˆ›å»ºæ—¶é—´åŒæ­¥æ£€æŸ¥å·¥å…·

åˆ›å»º `src/utils/time_utils.py`ï¼Œæä¾›æ—¶é—´åŒæ­¥æ£€æŸ¥åŠŸèƒ½ï¼š

```python
async def check_time_sync() -> dict:
    """
    æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦ä¸æœåŠ¡å™¨æ—¶é—´åŒæ­¥

    Returns:
        dict: åŒ…å«æ—¶é—´åŒæ­¥ä¿¡æ¯çš„å­—å…¸
            - local_time: æœ¬åœ°æ—¶é—´
            - server_time: æœåŠ¡å™¨æ—¶é—´
            - time_offset: æ—¶é—´åå·®ï¼ˆç§’ï¼‰
            - is_synced: æ˜¯å¦åŒæ­¥ï¼ˆåå·®å°äº 30 ç§’ï¼‰
            - recommended_action: å»ºè®®æ“ä½œ
    """
    # è·å–æœ¬åœ°æ—¶é—´
    local_time = datetime.now(timezone.utc)

    # é€šè¿‡ OKX API è·å–æœåŠ¡å™¨æ—¶é—´
    server_time = await get_okx_server_time()
    time_offset = (server_time - local_time).total_seconds()

    # æ£€æŸ¥æ˜¯å¦åŒæ­¥ï¼ˆåå·®å°äº 30 ç§’ï¼‰
    is_synced = abs(time_offset) < 30

    return {
        'local_time': local_time,
        'server_time': server_time,
        'time_offset': time_offset,
        'is_synced': is_synced,
        'recommended_action': 'sync_time' if not is_synced else 'none'
    }
```

#### æ–¹æ¡ˆ 2ï¼šåœ¨å¯åŠ¨æ—¶æ£€æŸ¥æ—¶é—´åŒæ­¥

åœ¨ `main_hft.py` ä¸­æ·»åŠ æ—¶é—´åŒæ­¥æ£€æŸ¥ï¼š

```python
async def main():
    """ä¸»å‡½æ•°"""

    #0. ğŸ” æ—¶é—´åŒæ­¥æ£€æŸ¥ï¼ˆè§£å†³ API ç­¾åé—®é¢˜ï¼‰
    try:
        print("\n" + "=" * 60)
        print("ğŸ” æ£€æŸ¥ç³»ç»Ÿæ—¶é—´åŒæ­¥...")
        print("=" * 60)
        await sync_time_check_async()
        print("âœ… æ—¶é—´åŒæ­¥æ­£å¸¸\n")
    except Exception as e:
        print(f"\nâŒ æ—¶é—´åŒæ­¥æ£€æŸ¥å¤±è´¥: {e}")
        print("è¯·å…ˆåŒæ­¥ç³»ç»Ÿæ—¶é—´åé‡è¯•ã€‚")
        return

    #1. åŠ è½½ç¯å¢ƒå˜é‡
    load_dotenv()
    # ... å…¶ä»–ä»£ç 
```

#### æ–¹æ¡ˆ 3ï¼šåŒæ­¥ç³»ç»Ÿæ—¶é—´

**Windows:**
```
æ§åˆ¶é¢æ¿ â†’ æ—¥æœŸå’Œæ—¶é—´ â†’ ç«‹å³åŒæ­¥
```

**Linux:**
```bash
sudo ntpdate -s time.nist.gov
```

**macOS:**
```bash
sudo sntp -sS time.apple.com
```

### ä¿®æ”¹æ–‡ä»¶

- âœ… `src/utils/time_utils.py`ï¼ˆæ–°å»ºï¼‰
- âœ… `main_hft.py`ï¼ˆæ·»åŠ æ—¶é—´åŒæ­¥æ£€æŸ¥ï¼‰

### éªŒè¯ç»“æœ

```bash
python -m py_compile src/utils/time_utils.py main_hft.py
âœ… ç¼–è¯‘æˆåŠŸ
```

---

## ğŸ“Š ä¿®å¤æ€»ç»“

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | ä¿®æ”¹æ–‡ä»¶ | ä¿®å¤çŠ¶æ€ |
|------|---------|---------|---------|
| é…ç½®éªŒè¯å¤±è´¥ | ğŸ”´ ä¸¥é‡ | `config/base.json` | âœ… å·²ä¿®å¤ |
| ç¯å¢ƒå˜é‡è¯»å–ä¸è¶³ | ğŸ”´ ä¸¥é‡ | `.env.example` | âœ… å·²ä¿®å¤ |
| API ç­¾åå’Œæ—¶é—´æˆ³é”™è¯¯ | ğŸ”´ ä¸¥é‡ | `src/utils/time_utils.py`, `main_hft.py` | âœ… å·²ä¿®å¤ |

---

## âœ… éªŒè¯æ­¥éª¤

### 1. éªŒè¯é…ç½®åŠ è½½

```bash
# å¯åŠ¨ HFT å¼•æ“
python main_hft.py

# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤é…ç½®åŠ è½½æˆåŠŸ
INFO - ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®: 20 ä¸ªå‚æ•°  # âœ… åº”è¯¥è¯»å–åˆ° 20 ä¸ªå‚æ•°
INFO - é«˜é¢‘äº¤æ˜“ç­–ç•¥é…ç½®åŠ è½½æˆåŠŸ        # âœ… é…ç½®åŠ è½½æˆåŠŸ
```

### 2. éªŒè¯æ—¶é—´åŒæ­¥

```bash
# å¯åŠ¨ HFT å¼•æ“
python main_hft.py

# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ—¶é—´åŒæ­¥æ­£å¸¸
============================================================
ğŸ” æ£€æŸ¥ç³»ç»Ÿæ—¶é—´åŒæ­¥...
============================================================
INFO - æœ¬åœ°æ—¶é—´ (UTC): 2024-01-09T04:44:26.654
INFO - OKX æœåŠ¡å™¨æ—¶é—´: 2024-01-09T04:44:26.123
INFO - æ—¶é—´åå·®: 0.53 ç§’
INFO - âœ… æ—¶é—´åŒæ­¥æ­£å¸¸
âœ… æ—¶é—´åŒæ­¥æ­£å¸¸
```

### 3. éªŒè¯ API ç­¾å

```bash
# å¯åŠ¨ HFT å¼•æ“
python main_hft.py

# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤ WebSocket ç™»å½•æˆåŠŸ
INFO - å‘é€ç™»å½•åŒ…: {"op":"login",...}
INFO - ç™»å½•åŒ…å·²å‘é€
INFO - âœ… ç™»å½•æˆåŠŸ              # âœ… ç™»å½•æˆåŠŸ
INFO - å·²è®¢é˜… positions é¢‘é“
INFO - å·²è®¢é˜… orders é¢‘é“
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æ—¶é—´åŒæ­¥æ£€æŸ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** è¯·å…ˆåŒæ­¥ç³»ç»Ÿæ—¶é—´ï¼š

**Windows:**
```
æ§åˆ¶é¢æ¿ â†’ æ—¥æœŸå’Œæ—¶é—´ â†’ ç«‹å³åŒæ­¥
```

**Linux:**
```bash
sudo ntpdate -s time.nist.gov
```

**macOS:**
```bash
sudo sntp -sS time.apple.com
```

---

### Q2: å¦‚ä½•ç¡®è®¤ç¯å¢ƒå˜é‡å·²åŠ è½½ï¼Ÿ

**A:** æŸ¥çœ‹æ—¥å¿—ä¸­çš„é…ç½®åŠ è½½ä¿¡æ¯ï¼š

```
INFO - ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®: 20 ä¸ªå‚æ•°  # âœ… æˆåŠŸåŠ è½½
```

å¦‚æœåªæ˜¾ç¤º `1 ä¸ªå‚æ•°`ï¼Œè¯´æ˜ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®ï¼Œè¯·æ£€æŸ¥ `.env` æ–‡ä»¶ã€‚

---

### Q3: å¦‚ä½•ç¡®è®¤é…ç½®å‚æ•°æ­£ç¡®ï¼Ÿ

**A:** æŸ¥çœ‹æ—¥å¿—ä¸­çš„é…ç½®ä¿¡æ¯ï¼š

```
INFO - HybridEngine åˆå§‹åŒ–: symbol=BTC-USDT-SWAP, mode=hybrid, order_size=1, ...
```

ç¡®è®¤å‚æ•°å€¼ç¬¦åˆé¢„æœŸã€‚

---

## ğŸ“ åç»­å»ºè®®

è™½ç„¶å·²ç»ä¿®å¤äº†è¿™ 3 ä¸ªå…³é”®é—®é¢˜ï¼Œä½†ä»æœ‰ä»¥ä¸‹å¯ä»¥æ”¹è¿›çš„æ–¹å‘ï¼š

### 1. è‡ªåŠ¨æ—¶é—´åŒæ­¥ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

æ·»åŠ è‡ªåŠ¨æ—¶é—´åŒæ­¥åŠŸèƒ½ï¼Œåœ¨æ£€æµ‹åˆ°æ—¶é—´åå·®æ—¶è‡ªåŠ¨åŒæ­¥ã€‚

### 2. é…ç½®çƒ­æ›´æ–°ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ›´æ–°é…ç½®ï¼Œæ— éœ€é‡å¯ç¨‹åºã€‚

### 3. é…ç½®éªŒè¯å·¥å…·ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

æä¾›é…ç½®éªŒè¯å·¥å…·ï¼Œåœ¨å¯åŠ¨å‰æ£€æŸ¥æ‰€æœ‰é…ç½®å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚

### 4. é”™è¯¯æ¢å¤æœºåˆ¶ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

æ·»åŠ é”™è¯¯æ¢å¤æœºåˆ¶ï¼Œåœ¨ API ç­¾åå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚

---

## ğŸ‰ æ€»ç»“

é€šè¿‡ä¿®å¤è¿™ 3 ä¸ªå…³é”®é—®é¢˜ï¼ŒHFT æ¨¡å—çš„ç¨³å®šæ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼š

1. **é…ç½®éªŒè¯å¤±è´¥**ï¼šä¿®å¤äº† `order_size` ç±»å‹ä¸åŒ¹é…é—®é¢˜
2. **ç¯å¢ƒå˜é‡è¯»å–ä¸è¶³**ï¼šæä¾›äº†å®Œæ•´çš„ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
3. **API ç­¾åå’Œæ—¶é—´æˆ³é”™è¯¯**ï¼šæ·»åŠ äº†æ—¶é—´åŒæ­¥æ£€æŸ¥åŠŸèƒ½

è¿™äº›ä¿®å¤ä¸º HFT æ¨¡å—çš„ç¨³å®šè¿è¡Œå¥ å®šäº†æ›´åŠ åšå®çš„åŸºç¡€ã€‚
