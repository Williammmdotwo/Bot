# ä»“ä½ç®¡ç†æ¨¡å‹ (Position Management Models)

## ğŸ“‹ æ¦‚è¿°

ä»“ä½ç®¡ç†æ˜¯é‡åŒ–äº¤æ˜“ä¸­æœ€å…³é”®çš„é£é™©æ§åˆ¶æœºåˆ¶ã€‚Athena Trader å®ç°äº†å¤šç§ä»“ä½ç®¡ç†æ¨¡å‹ï¼Œå…¶ä¸­"ä¸æ­»é¸Ÿ"æ¨¡å‹ï¼ˆFixed Risk Modelï¼‰æ˜¯æ¨èçš„é»˜è®¤é€‰æ‹©ã€‚

---

## ğŸ¦… "ä¸æ­»é¸Ÿ"æ¨¡å‹ (Fixed Risk Model)

### æ ¸å¿ƒåŸç†

**æ¯å•æœ€å¤šåªäºæœ¬é‡‘çš„å›ºå®šæ¯”ä¾‹ï¼ˆé»˜è®¤ 2%ï¼‰**

è¿™ä¸ªæ¨¡å‹ç¡®ä¿å³ä½¿è¿ç»­å¤šæ¬¡äºæŸï¼Œè´¦æˆ·ä»æœ‰è¶³å¤Ÿçš„æœ¬é‡‘ç»§ç»­äº¤æ˜“ï¼Œå®ç°é•¿æœŸç”Ÿå­˜ã€‚

### æ•°å­¦åŸç†

#### åŸºç¡€å…¬å¼

```python
# 1. è®¡ç®—å…è®¸çš„æœ€å¤§äºæŸé‡‘é¢
max_risk_amount = capital Ã— max_risk_pct

# 2. è®¡ç®—æ¯å•ä½çš„æ­¢æŸé‡‘é¢
risk_per_unit = current_price - stop_loss_price

# 3. è®¡ç®—åº”è¯¥ä¹°å…¥çš„æ•°é‡ï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰
position_size = max_risk_amount / risk_per_unit

# 4. è®¡ç®—ä»“ä½ä»·å€¼
position_value = position_size Ã— current_price

# 5. è®¡ç®—å®é™…æ æ†ç‡
leverage = position_value / capital
```

#### æ æ†ç‡è°ƒæ•´

```python
# ç¡®ä¿æ æ†ç‡åœ¨åˆç†èŒƒå›´å†…
if leverage > max_leverage:
    # æ æ†è¿‡é«˜ï¼Œé™ä½ä»“ä½
    target_position_value = capital Ã— max_leverage
    position_size = target_position_value / current_price
    position_value = target_position_value
    leverage = max_leverage
elif leverage < min_leverage:
    # æ æ†è¿‡ä½ï¼Œè®°å½•æ—¥å¿—ï¼ˆå¯é€‰ï¼šæé«˜ä»“ä½ï¼‰
    logger.info(f"Leverage low ({leverage:.2f}x), could increase to {min_leverage}x")
```

### è¿ç»­äºæŸåˆ†æ

å‡è®¾æ¯å•æœ€å¤§äºæŸä¸º 2%ï¼Œè¿ç»­äºæŸåçš„å‰©ä½™æœ¬é‡‘ï¼š

| äºæŸæ¬¡æ•° | å‰©ä½™æœ¬é‡‘ | äºæŸç‡ |
|---------|-----------|---------|
| 1 | 98% | 2% |
| 5 | 90.4% | 9.6% |
| 10 | 81.7% | 18.3% |
| 20 | 66.8% | 33.2% |
| 30 | 54.6% | 45.4% |
| 40 | 44.6% | 55.4% |
| 50 | 36.4% | 63.6% |
| 100 | 13.3% | 86.7% |

**å…³é”®æ´å¯Ÿ**: å³ä½¿è¿ç»­äºæŸ 50 æ¬¡ï¼Œä»æœ‰ 36% çš„æœ¬é‡‘å¯ä»¥ç»§ç»­äº¤æ˜“ï¼

### è®¡ç®—ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæ­£å¸¸æƒ…å†µ

**åœºæ™¯**:
- SOL ä»·æ ¼: $150
- æ­¢æŸä»·æ ¼: $145ï¼ˆ-3.3%ï¼‰
- æœ¬é‡‘: $100
- æœ€å¤§é£é™©: 2%

**è®¡ç®—è¿‡ç¨‹**:
```
max_risk_amount = $100 Ã— 2% = $2
risk_per_unit = $150 - $145 = $5
position_size = $2 / $5 = 0.4 SOL
position_value = 0.4 Ã— $150 = $60
leverage = $60 / $100 = 0.6x
actual_risk = 0.4 Ã— $5 = $2 (2%)
```

**ç»“æœ**:
- ä»“ä½æ•°é‡: 0.4 SOL
- ä»“ä½ä»·å€¼: $60
- æ æ†ç‡: 0.6x
- æœ€å¤§äºæŸ: $2 (2%)

#### ç¤ºä¾‹ 2ï¼šå°æ­¢æŸè·ç¦»

**åœºæ™¯**:
- SOL ä»·æ ¼: $150
- æ­¢æŸä»·æ ¼: $149ï¼ˆ-0.67%ï¼‰
- æœ¬é‡‘: $100
- æœ€å¤§é£é™©: 2%

**è®¡ç®—è¿‡ç¨‹**:
```
max_risk_amount = $100 Ã— 2% = $2
risk_per_unit = $150 - $149 = $1
position_size = $2 / $1 = 2 SOL
position_value = 2 Ã— $150 = $300
leverage = $300 / $100 = 3x (è¢«é™åˆ¶)
actual_risk = 2 Ã— $1 = $2 (2%)
```

**ç»“æœ**:
- ä»“ä½æ•°é‡: 2 SOL
- ä»“ä½ä»·å€¼: $300
- æ æ†ç‡: 3x (è¾¾åˆ°ä¸Šé™)
- æœ€å¤§äºæŸ: $2 (2%)

#### ç¤ºä¾‹ 3ï¼šå¤§æ­¢æŸè·ç¦»

**åœºæ™¯**:
- SOL ä»·æ ¼: $150
- æ­¢æŸä»·æ ¼: $135ï¼ˆ-10%ï¼‰
- æœ¬é‡‘: $100
- æœ€å¤§é£é™©: 2%

**è®¡ç®—è¿‡ç¨‹**:
```
max_risk_amount = $100 Ã— 2% = $2
risk_per_unit = $150 - $135 = $15
position_size = $2 / $15 = 0.133 SOL
position_value = 0.133 Ã— $150 = $20
leverage = $20 / $100 = 0.2x
actual_risk = 0.133 Ã— $15 = $2 (2%)
```

**ç»“æœ**:
- ä»“ä½æ•°é‡: 0.133 SOL
- ä»“ä½ä»·å€¼: $20
- æ æ†ç‡: 0.2x (ä½äºæœ€å°å€¼)
- æœ€å¤§äºæŸ: $2 (2%)

### ä¼˜åŠ¿

âœ… **é£é™©å¯æ§**: æ¯å•æœ€å¤§äºæŸå›ºå®š
âœ… **é•¿æœŸç”Ÿå­˜**: å³ä½¿è¿ç»­äºæŸä»èƒ½ç»§ç»­äº¤æ˜“
âœ… **è‡ªåŠ¨è°ƒæ•´**: æ ¹æ®æ­¢æŸè·ç¦»åŠ¨æ€è®¡ç®—ä»“ä½
âœ… **æ æ†é™åˆ¶**: é¿å…é«˜æ æ†çˆ†ä»“é£é™©
âœ… **æ˜“äºç†è§£**: é€»è¾‘æ¸…æ™°ï¼Œå‚æ•°å¯è§£é‡Š

### åŠ£åŠ¿

âŒ **æ”¶ç›Šæœ‰é™**: ä½æ æ†å¯¼è‡´å•ç¬”æ”¶ç›Šæœ‰é™
âŒ **éœ€è¦è€å¿ƒ**: å¯èƒ½éœ€è¦å¤šç¬”äº¤æ˜“å®ç°å¤åˆ©
âŒ **ä¾èµ–æ­¢æŸ**: æ­¢æŸè®¾ç½®ä¸å½“ä¼šå½±å“ä»“ä½å¤§å°

---

## ğŸ“Š å…¶ä»–ä»“ä½ç®¡ç†æ¨¡å‹

### 1. å›ºå®šä»“ä½æ¨¡å‹ (Fixed Position Size)

æ¯æ¬¡äº¤æ˜“ä½¿ç”¨å›ºå®šæ•°é‡çš„ä»“ä½ã€‚

```python
position_size = fixed_amount  # ä¾‹å¦‚ï¼šæ¯æ¬¡ä¹° 1 SOL
```

**ä¼˜åŠ¿**:
- ç®€å•æ˜“æ‡‚
- ä¸ä¾èµ–æ­¢æŸè·ç¦»

**åŠ£åŠ¿**:
- é£é™©ä¸å¯æ§ï¼ˆæ­¢æŸè¶Šå¤§ï¼Œé£é™©è¶Šé«˜ï¼‰
- ä¸é€‚åˆä¸åŒæ³¢åŠ¨æ€§çš„èµ„äº§

### 2. å›ºå®šç™¾åˆ†æ¯”æ¨¡å‹ (Fixed Percentage)

æ¯æ¬¡äº¤æ˜“ä½¿ç”¨å›ºå®šæ¯”ä¾‹çš„è´¦æˆ·èµ„äº§ã€‚

```python
position_value = capital Ã— position_pct
position_size = position_value / current_price
```

**ä¼˜åŠ¿**:
- ä»“ä½éšè´¦æˆ·å¢é•¿
- ç›¸å¯¹ç®€å•

**åŠ£åŠ¿**:
- é£é™©ä¸å¯æ§ï¼ˆæ­¢æŸè·ç¦»å˜åŒ–æ—¶é£é™©å˜åŒ–ï¼‰
- å¯èƒ½ä½¿ç”¨è¿‡é«˜æ æ†

### 3. å‡¯åˆ©å…¬å¼æ¨¡å‹ (Kelly Criterion)

åŸºäºèƒœç‡å’Œç›ˆäºæ¯”è®¡ç®—æœ€ä¼˜ä»“ä½ã€‚

```python
win_rate = wins / total_trades
avg_win = sum(wins) / wins
avg_loss = sum(losses) / losses
kelly_pct = (win_rate * avg_win - (1 - win_rate) * avg_loss) / avg_win

position_value = capital Ã— kelly_pct Ã— safety_factor  # safety_factor é€šå¸¸ä¸º 0.5
```

**ä¼˜åŠ¿**:
- ç†è®ºä¸Šæœ€ä¼˜çš„èµ„é‡‘å¢é•¿
- è€ƒè™‘å†å²èƒœç‡å’Œç›ˆäºæ¯”

**åŠ£åŠ¿**:
- éœ€è¦å¤§é‡å†å²æ•°æ®
- å¯¹å‚æ•°å˜åŒ–æ•æ„Ÿ
- å¯èƒ½å»ºè®®è¿‡é«˜çš„ä»“ä½

### 4. æ³¢åŠ¨ç‡è°ƒæ•´æ¨¡å‹ (Volatility-Adjusted)

åŸºäºèµ„äº§æ³¢åŠ¨ç‡è°ƒæ•´ä»“ä½å¤§å°ã€‚

```python
volatility = calculate_atr(period=14)
position_value = capital Ã— base_pct / volatility
```

**ä¼˜åŠ¿**:
- é«˜æ³¢åŠ¨èµ„äº§ä½¿ç”¨è¾ƒå°ä»“ä½
- ä½æ³¢åŠ¨èµ„äº§ä½¿ç”¨è¾ƒå¤§ä»“ä½
- ç»Ÿä¸€é£é™©æ°´å¹³

**åŠ£åŠ¿**:
- è®¡ç®—å¤æ‚
- éœ€è¦å†å²æ³¢åŠ¨ç‡æ•°æ®

---

## âš™ï¸ é…ç½®å‚æ•°

### "ä¸æ­»é¸Ÿ"æ¨¡å‹å‚æ•°

```json
{
  "trading": {
    "capital": 100.0,           // æœ¬é‡‘
    "max_risk_pct": 0.02,        // æ¯å•æœ€å¤§é£é™©ï¼ˆ2%ï¼‰
    "position_size_pct": 0.5,      // ä»“ä½å¤§å°ç™¾åˆ†æ¯”ï¼ˆå¤‡ç”¨ï¼‰
  },
  "strategy": {
    "max_leverage": 3.0,          // æœ€å¤§æ æ†
    "min_leverage": 2.0           // æœ€å°æ æ†
  }
}
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å»ºè®® |
|------|------|--------|------|
| `capital` | æœ¬é‡‘ | 100.0 | æ ¹æ®å®é™…æƒ…å†µè®¾ç½® |
| `max_risk_pct` | æ¯å•æœ€å¤§é£é™© | 0.02 (2%) | 0.01-0.03 |
| `max_leverage` | æœ€å¤§æ æ† | 3.0 | 2.0-3.0 |
| `min_leverage` | æœ€å°æ æ† | 2.0 | 1.5-2.0 |

### é£é™©ç­‰çº§å»ºè®®

| é£é™©ç­‰çº§ | max_risk_pct | max_leverage | é€‚ç”¨äººç¾¤ |
|---------|-------------|-------------|---------|
| ä¿å®ˆå‹ | 0.01 (1%) | 2.0x | æ–°æ‰‹ã€é£é™©åŒæ¶è€… |
| å¹³è¡¡å‹ | 0.02 (2%) | 3.0x | æœ‰ç»éªŒè€…ï¼ˆæ¨èï¼‰|
| æ¿€è¿›å‹ | 0.03 (3%) | 4.0x | é«˜é£é™©åå¥½è€… |

---

## ğŸ“ˆ æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | é£é™©æ§åˆ¶ | æ”¶ç›Šæ½œåŠ› | å¤æ‚åº¦ | æ¨èåº¦ |
|------|---------|---------|--------|--------|
| "ä¸æ­»é¸Ÿ"æ¨¡å‹ | â­â­â­â­â­ | â­â­â­ | â­â­ | â­â­â­â­â­ |
| å›ºå®šä»“ä½ | â­â­ | â­â­â­â­ | â­ | â­â­ |
| å›ºå®šç™¾åˆ†æ¯” | â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­ |
| å‡¯åˆ©å…¬å¼ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| æ³¢åŠ¨ç‡è°ƒæ•´ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |

---

## ğŸ”§ å®ç°ç»†èŠ‚

### ä»£ç å®ç°

```python
def calculate_position_size_fixed_risk(
    current_price: float,
    stop_loss_price: float,
    capital: float,
    max_risk_pct: float,
    max_leverage: float,
    min_leverage: float
) -> Dict[str, float]:
    """
    "ä¸æ­»é¸Ÿ"ä»“ä½è®¡ç®—

    Args:
        current_price: å½“å‰ä»·æ ¼
        stop_loss_price: æ­¢æŸä»·æ ¼
        capital: æœ¬é‡‘
        max_risk_pct: æœ€å¤§é£é™©æ¯”ä¾‹
        max_leverage: æœ€å¤§æ æ†
        min_leverage: æœ€å°æ æ†

    Returns:
        Dict: ä»“ä½ä¿¡æ¯
    """
    # 1. è®¡ç®—å…è®¸çš„æœ€å¤§äºæŸé‡‘é¢
    max_risk_amount = capital * max_risk_pct

    # 2. è®¡ç®—æ¯å•ä½çš„æ­¢æŸé‡‘é¢
    risk_per_unit = current_price - stop_loss_price
    if risk_per_unit <= 0:
        raise ValueError("Invalid stop loss price")

    # 3. è®¡ç®—ä»“ä½æ•°é‡
    position_size = max_risk_amount / risk_per_unit

    # 4. è®¡ç®—ä»“ä½ä»·å€¼
    position_value = position_size * current_price

    # 5. è®¡ç®—æ æ†ç‡
    leverage = position_value / capital

    # 6. æ æ†ç‡è°ƒæ•´
    if leverage > max_leverage:
        target_position_value = capital * max_leverage
        position_size = target_position_value / current_price
        position_value = target_position_value
        leverage = max_leverage
    elif leverage < min_leverage:
        logger.info(f"Leverage low ({leverage:.2f}x)")

    # 7. è®¡ç®—å®é™…é£é™©
    actual_risk = position_size * risk_per_unit

    return {
        'position_size': position_size,
        'position_value': position_value,
        'leverage': leverage,
        'risk_amount': actual_risk,
        'risk_pct': actual_risk / capital * 100,
        'max_risk_amount': max_risk_amount,
        'max_risk_pct': max_risk_pct * 100,
        'risk_per_unit': risk_per_unit
    }
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¶‹åŠ¿å›è°ƒç­–ç•¥](./TREND_PULLBACK_STRATEGY.md)
- [é£é™©ç®¡ç†](../RISK_MANAGEMENT.md)
- [ç­–ç•¥å¼•æ“æ¶æ„](../architecture/OKX_TRADING_SYSTEM_ARCHITECTURE.md)

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é£é™©ç®¡ç†

- âœ… æ°¸è¿œä¸è¦è¶…è¿‡æ¯å•æœ€å¤§é£é™©
- âœ… å®šæœŸå®¡æŸ¥å’Œè°ƒæ•´é£é™©å‚æ•°
- âœ… æ ¹æ®å¸‚åœºæ¡ä»¶è°ƒæ•´æ æ†ç‡
- âœ… ä¿æŒè¯¦ç»†çš„äº¤æ˜“è®°å½•

### 2. å‚æ•°ä¼˜åŒ–

- âœ… ä»ä¿å®ˆå‚æ•°å¼€å§‹
- âœ… ä½¿ç”¨å†å²æ•°æ®å›æµ‹
- âœ… åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­éªŒè¯
- âœ… é€æ­¥ä¼˜åŒ–ï¼Œä¸è¦ä¸€æ¬¡æ€§å¤§å¹…è°ƒæ•´

### 3. å¿ƒç†ç®¡ç†

- âœ… æ¥å—è¿ç»­äºæŸæ˜¯æ­£å¸¸çš„
- âœ… ä¸è¦å› ä¸ºäºæŸè€Œè¿‡åº¦è°ƒæ•´å‚æ•°
- âœ… ä¿æŒçºªå¾‹ï¼Œä¸¥æ ¼éµå¾ªç­–ç•¥
- âœ… å®šæœŸè¯„ä¼°ç­–ç•¥è¡¨ç°

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ28æ—¥
