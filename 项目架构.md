# Athena Trader é¡¹ç›®æ¶æ„æŠ¥å‘Šï¼ˆAIç†è§£ä¸“ç”¨ç‰ˆï¼‰
*é¡¹ç›®ç›®å‰è¿è¡Œåœ¨æ–°åŠ å¡æœåŠ¡å™¨1G1CPU*
*æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ14æ—¥ - ç§»é™¤SniperStrategyå’ŒVultureStrategyï¼Œç®€åŒ–ç­–ç•¥æ¶æ„*

## 1. é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**ï¼šAthena Trader (Athena OS v3.0)
**é¡¹ç›®ç±»å‹**ï¼šåŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ
**ç›®æ ‡äº¤æ˜“æ‰€**ï¼šOKXï¼ˆä¸»è¦æ”¯æŒSWAPæ°¸ç»­åˆçº¦ï¼‰
**æ¶æ„æ¨¡å¼**ï¼šäº‹ä»¶é©±åŠ¨ + å¼‚æ­¥å¾®æœåŠ¡åŒ–

### 1.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ
- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šæ‰€æœ‰æ¨¡å—é€šè¿‡EventBusè§£è€¦ï¼Œä½¿ç”¨Pub/Subæ¨¡å¼é€šä¿¡
- **å¼‚æ­¥ä¼˜å…ˆ**ï¼šåŸºäºasyncioå’Œaiohttpçš„é«˜æ€§èƒ½å¼‚æ­¥è®¾è®¡
- **ä¾èµ–æ³¨å…¥**ï¼šç»„ä»¶é—´æ¾è€¦åˆï¼Œæ˜“äºæµ‹è¯•å’Œæ‰©å±•
- **ç­–ç•¥åˆ†ç¦»**ï¼šç­–ç•¥åªè´Ÿè´£äº¤æ˜“é€»è¾‘ï¼Œä¸å…³å¿ƒæ•°æ®æºå’Œç½‘ç»œé€šä¿¡
- **é£æ§è´¯ç©¿**ï¼šèµ„é‡‘ç®¡ç†ã€äº¤æ˜“å‰æ£€æŸ¥ã€æŒä»“å¯¹è´¦ç­‰å¤šå±‚é£æ§
- **è½»é‡åŒ–ä¼˜åŒ–**ï¼šé’ˆå¯¹1æ ¸1Gå†…å­˜ç¯å¢ƒä¼˜åŒ–ï¼Œç§»é™¤pandasç­‰é‡å‹ä¾èµ–

---

## 2. ç³»ç»Ÿæ¶æ„å±‚æ¬¡

### 2.1 å…¥å£å±‚
**main.py**
- åŠŸèƒ½ï¼šç³»ç»Ÿå¯åŠ¨å…¥å£
- èŒè´£ï¼š
  1. é…ç½®æ—¥å¿—ç³»ç»Ÿ
  2. åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆ.envæ–‡ä»¶ï¼‰
  3. ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®
  4. åˆå§‹åŒ–å¼•æ“
  5. å¯åŠ¨ç³»ç»Ÿå¹¶ç›‘å¬é€€å‡ºä¿¡å·
  6. ä¼˜é›…é€€å‡ºå¤„ç†

**â­ 2026å¹´1æœˆ13æ—¥æ›´æ–°**ï¼š
- **æ¸…ç©ºé»˜è®¤ç­–ç•¥åˆ—è¡¨**ï¼šç§»é™¤ Sniper ç¡¬ç¼–ç é…ç½®ï¼Œé¿å…æŠ¢å èµ„é‡‘
- **ç¯å¢ƒå˜é‡è°ƒè¯•**ï¼šå¯åŠ¨æ—¶æ‰“å°å…³é”®ç¯å¢ƒå˜é‡ï¼Œä¾¿äºè¯Šæ–­é…ç½®é—®é¢˜
- **ä¿®æ”¹é»˜è®¤å€¼**ï¼šScalperV1 é»˜è®¤äº¤æ˜“å¯¹æ”¹ä¸º SOL-USDT-SWAPï¼Œé»˜è®¤èµ„é‡‘æ”¹ä¸º 10000U

**é…ç½®åŠ è½½æµç¨‹**ï¼š
```
ç¯å¢ƒå˜é‡ (.env)
    â†“
load_config_from_env()
    â”œâ”€ ğŸ” è°ƒè¯•æ—¥å¿—ï¼šæ‰“å°å…³é”®ç¯å¢ƒå˜é‡
    â”œâ”€ ğŸ”§ ä¿®å¤ï¼šæ¸…ç©ºé»˜è®¤ strategies åˆ—è¡¨
    â””â”€ ğŸ”§ ä¿®å¤ï¼šä¿®æ”¹ ScalperV1 é»˜è®¤å€¼ä¸º SOL å’Œ 10000U
    â†“
é…ç½®å­—å…¸ {
    total_capital: float,
    rest_gateway: {api_key, secret_key, passphrase, use_demo},
    public_ws: {symbol},
    private_ws: {use_demo},
    risk: {max_order_amount, max_frequency},
    strategies: [{id, type, capital, params}]
}
    â†“
Engine(config)
```

**ç¯å¢ƒå˜é‡è°ƒè¯•è¾“å‡º**ï¼š
```python
logger.info("=" * 60)
logger.info("ğŸ” ç¯å¢ƒå˜é‡æ£€æŸ¥")
logger.info("=" * 60)
logger.info(f"ACTIVE_STRATEGY: {os.getenv('ACTIVE_STRATEGY', 'NOT SET')}")
logger.info(f"SCALPER_SYMBOL: {os.getenv('SCALPER_SYMBOL', 'NOT SET')}")
logger.info(f"SCALPER_CAPITAL: {os.getenv('SCALPER_CAPITAL', 'NOT SET')}")
logger.info(f"TOTAL_CAPITAL: {os.getenv('TOTAL_CAPITAL', 'NOT SET')}")
logger.info("=" * 60)
```

---

## 3. æ ¸å¿ƒæ¨¡å—

### 3.1 Coreæ¨¡å— (src/core/)

#### 3.1.1 Engine (ä¸»å¼•æ“)
**æ–‡ä»¶**ï¼šengine.py

**æ ¸å¿ƒèŒè´£**ï¼š
- ç³»ç»Ÿçš„æŒ‡æŒ¥å®˜ï¼Œè´Ÿè´£ç»„è£…æ‰€æœ‰ç»„ä»¶
- ç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆinitialize, start, stopï¼‰
- ä¾èµ–æ³¨å…¥å®¹å™¨

**ç»„ä»¶åˆå§‹åŒ–é¡ºåº**ï¼š
1. EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰
2. OMSç»„ä»¶
3. Gatewayç»„ä»¶
4. é£æ§æ£€æŸ¥å™¨
5. OrderManagerï¼ˆæ³¨å…¥é£æ§ï¼‰
6. Strategies
7. äº‹ä»¶å¤„ç†å™¨æ³¨å†Œ
8. ç­–ç•¥èµ„é‡‘åˆ†é…

**å…³é”®æ–¹æ³•**ï¼š
- `initialize()`: åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
- `start()`: è¿æ¥ç½‘å…³ï¼Œå¯åŠ¨ç­–ç•¥ï¼Œè¿›å…¥ä¸»å¾ªç¯
- `stop()`: åœæ­¢ç­–ç•¥ï¼Œæ–­å¼€ç½‘å…³ï¼Œä¼˜é›…é€€å‡º
- `_load_strategy()`: åŠ¨æ€åŠ è½½ç­–ç•¥ï¼ˆæ”¯æŒscalper_v1ï¼‰
- `_register_event_handlers()`: æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
- `_allocate_strategy_capitals()`: åˆ†é…ç­–ç•¥èµ„é‡‘

**é…ç½®ç¤ºä¾‹**ï¼š
```python
{
    'total_capital': 10000.0,
    'sync_threshold_pct': 0.10,
    'sync_cooldown_seconds': 60,
    'rest_gateway': {'use_demo': True, 'timeout': 10},
    'public_ws': {'symbol': 'BTC-USDT-SWAP', 'use_demo': True},
    'private_ws': {'use_demo': True},
    'risk': {'max_order_amount': 2000.0, 'max_frequency': 5, 'frequency_window': 1.0},
    'strategies': [...]
}
```

#### 3.1.2 EventBus (äº‹ä»¶æ€»çº¿)
**æ–‡ä»¶**ï¼ševent_bus.py

**è®¾è®¡åŸåˆ™**ï¼š
- è½»é‡çº§ï¼Œé›¶ä¾èµ–
- å¼‚æ­¥è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘
- ç±»å‹å®‰å…¨ï¼Œä½¿ç”¨æ ‡å‡†äº‹ä»¶æ ¼å¼
- è§£è€¦æ¨¡å—é—´ä¾èµ–

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- `register(event_type, handler)`: æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
- `unregister(event_type, handler)`: å–æ¶ˆæ³¨å†Œ
- `put(event)`: å¼‚æ­¥å‘å¸ƒäº‹ä»¶
- `put_nowait(event)`: éé˜»å¡å‘å¸ƒäº‹ä»¶
- `start()`: å¯åŠ¨åå°å¤„ç†å¾ªç¯
- `stop()`: åœæ­¢å¹¶æ¸…ç©ºé˜Ÿåˆ—

**äº‹ä»¶å¤„ç†æµç¨‹**ï¼š
```
Eventå‘å¸ƒ â†’ Queue (maxsize=10000)
    â†“
åå°å¾ªç¯ _process_loop()
    â†“
è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„å¤„ç†å™¨
    â†“
å¤„ç†å¼‚å¸¸å¹¶å‘å¸ƒERRORäº‹ä»¶
```

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- published: å‘å¸ƒæ€»æ•°
- processed: å¤„ç†æ€»æ•°
- errors: é”™è¯¯æ€»æ•°
- queue_size: é˜Ÿåˆ—å¤§å°
- handlers: å¤„ç†å™¨æ€»æ•°

#### 3.1.3 EventTypes (äº‹ä»¶ç±»å‹)
**æ–‡ä»¶**ï¼ševent_types.py

**äº‹ä»¶ç±»å‹**ï¼š
- TICK: è¡Œæƒ…Tick
- ORDER_SUBMITTED: è®¢å•å·²æäº¤
- ORDER_UPDATE: è®¢å•çŠ¶æ€æ›´æ–°
- ORDER_FILLED: è®¢å•æˆäº¤
- ORDER_CANCELLED: è®¢å•å–æ¶ˆ
- POSITION_UPDATE: æŒä»“æ›´æ–°
- ERROR: é”™è¯¯äº‹ä»¶

---

### 3.2 OMSæ¨¡å— (src/oms/)

#### 3.2.1 CapitalCommander (èµ„é‡‘æŒ‡æŒ¥å®˜)
**æ–‡ä»¶**ï¼šcapital_commander.py

**æ ¸å¿ƒèŒè´£**ï¼š
- ç®¡ç†æ€»èµ„é‡‘æ± 
- åˆ†é…ç­–ç•¥èµ„é‡‘
- è¿½è¸ªç­–ç•¥ç›ˆäº
- å®æ—¶æ›´æ–°èµ„é‡‘çŠ¶æ€
- **ç®¡ç†ç­–ç•¥é£æ§é…ç½®ï¼ˆRiskProfileï¼‰**
- **æ‰§è¡Œç­–ç•¥çº§åˆ«çš„é£æ§æ£€æŸ¥**

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class StrategyCapital:
    allocated: float  # åˆ†é…èµ„é‡‘
    used: float       # å·²ä½¿ç”¨èµ„é‡‘
    profit: float     # ç´¯è®¡ç›ˆäº
    available: float  # å¯ç”¨èµ„é‡‘ = allocated - used + profit
```

**å…³é”®æ–¹æ³•**ï¼š
- `allocate_strategy(strategy_id, amount)`: åˆ†é…èµ„é‡‘
- `check_buying_power(strategy_id, amount_usdt)`: æ£€æŸ¥è´­ä¹°åŠ›
- `reserve_capital(strategy_id, amount_usdt)`: é¢„ç•™èµ„é‡‘ï¼ˆä¸‹å•å‰ï¼‰
- `release_capital(strategy_id, amount_usdt)`: é‡Šæ”¾èµ„é‡‘ï¼ˆæ’¤å•åï¼‰
- `record_profit(strategy_id, profit_usdt)`: è®°å½•ç›ˆäº
- `on_order_filled(event)`: ç›‘å¬è®¢å•æˆäº¤äº‹ä»¶ï¼Œè‡ªåŠ¨æ›´æ–°èµ„é‡‘

**RiskProfile ç®¡ç†æ–¹æ³•**ï¼š
- `register_risk_profile(profile: RiskProfile)`: æ³¨å†Œç­–ç•¥é£æ§é…ç½®
  - å­˜å‚¨ç­–ç•¥çš„é£æ§å‚æ•°
  - è®°å½•æ—¥å¿—ä»¥ä¾¿è¿½è¸ª
- `get_strategy_profile(strategy_id: str)`: è·å–ç­–ç•¥é£æ§é…ç½®
  - è¿”å›è¯¥ç­–ç•¥çš„ RiskProfile
  - æœªæ³¨å†Œæ—¶è¿”å› None
- `check_policy_compliance(strategy_id, amount_usdt, entry_price)`: æ£€æŸ¥ç­–ç•¥é£æ§åˆè§„æ€§
  - æ£€æŸ¥å•ç¬”è®¢å•é‡‘é¢é™åˆ¶ï¼ˆmax_order_size_usdtï¼‰
  - æ£€æŸ¥ç­–ç•¥æœ€å¤§æ æ†é™åˆ¶ï¼ˆmax_leverageï¼‰
  - æœªæ³¨å†Œ Profile æ—¶ä½¿ç”¨é»˜è®¤ä¿å®ˆé…ç½®

**èµ„é‡‘è®¡ç®—é€»è¾‘**ï¼š
- ä¹°å…¥ï¼šé‡Šæ”¾é¢„ç•™èµ„é‡‘
- å–å‡ºï¼šè®°å½•ç›ˆäºï¼ˆç®€åŒ–å¤„ç†ï¼Œå®é™…åœ¨PositionManagerä¸­è®¡ç®—ï¼‰

**é£æ§æ£€æŸ¥é€»è¾‘**ï¼š
1. ç­–ç•¥å±‚é£æ§ï¼ˆRiskProfileï¼‰ï¼š
   - ç­–ç•¥æœ€å¤§æ æ†é™åˆ¶
   - å•ç¬”è®¢å•é‡‘é¢é™åˆ¶
2. å…¨å±€å±‚é£æ§ï¼ˆRiskConfigï¼‰ï¼š
   - å…¨å±€æ æ†ä¸Šé™ï¼ˆ3xï¼Œæœ€åä¸€é“é˜²çº¿ï¼‰
   - å›æ’¤ç†”æ–­æ£€æŸ¥

#### 3.2.2 OrderManager (è®¢å•ç®¡ç†å™¨)
**æ–‡ä»¶**ï¼šorder_manager.py

**æ ¸å¿ƒèŒè´£**ï¼š
- æ¥æ”¶ç­–ç•¥ä¸‹å•è¯·æ±‚
- é£æ§æ£€æŸ¥ï¼ˆé›†æˆPreTradeCheckï¼‰
- è°ƒç”¨Gatewayå‘å•
- è¿½è¸ªè®¢å•çŠ¶æ€
- è‡ªåŠ¨æ’¤å•

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class Order:
    order_id: str
    symbol: str
    side: str           # "buy" or "sell"
    order_type: str      # "market", "limit", "ioc"
    size: float
    price: float
    filled_size: float = 0.0
    status: str = "pending"  # pending, live, filled, cancelled, rejected
    strategy_id: str = "default"
    raw: dict = None
```

**å…³é”®æ–¹æ³•**ï¼š
- `submit_order(symbol, side, order_type, size, price, strategy_id)`: æäº¤è®¢å•
  - é£æ§æ£€æŸ¥
  - è°ƒç”¨Gatewayä¸‹å•
  - ä¿å­˜æœ¬åœ°è®¢å•
  - æ¨é€ORDER_SUBMITTEDäº‹ä»¶
- `cancel_order(order_id, symbol)`: æ’¤é”€è®¢å•
- `cancel_all_orders(symbol)`: æ’¤é”€æ‰€æœ‰è®¢å•
- `get_all_orders()`: è·å–æ‰€æœ‰è®¢å•ï¼ˆç”¨äºæµ‹è¯•ï¼‰
- `on_order_update(event)`: ç›‘å¬è®¢å•æ›´æ–°
- `on_order_filled(event)`: ç›‘å¬è®¢å•æˆäº¤
- `on_order_cancelled(event)`: ç›‘å¬è®¢å•å–æ¶ˆ

**è®¢å•çŠ¶æ€æµè½¬**ï¼š
```
pending â†’ live â†’ filled/cancelled/rejected
```

#### 3.2.3 PositionManager (æŒä»“ç®¡ç†å™¨)
**æ–‡ä»¶**ï¼šposition_manager.py

**æ ¸å¿ƒèŒè´£**ï¼š
- å®æ—¶ç»´æŠ¤æœ¬åœ°æŒä»“çŠ¶æ€
- è®¡ç®—æŒä»“ç›ˆäº
- å¤„ç†æœŸæœ›æŒä»“ä¸å®é™…æŒä»“çš„åŒæ­¥ï¼ˆShadow Ledgeré€»è¾‘ï¼‰
- **å¹½çµå•é˜²æŠ¤**ï¼šæŒä»“å½’é›¶æ—¶è‡ªåŠ¨æ’¤é”€æ‰€æœ‰æŒ‚å•

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class Position:
    symbol: str
    side: str           # "long" or "short"
    size: float         # æŒä»“æ•°é‡
    entry_price: float  # å¼€ä»“å‡ä»·
    unrealized_pnl: float = 0.0
    leverage: int = 1
    raw: dict = None

    @property
    def signed_size(self) -> float:
        # æœ‰ç¬¦å·æŒä»“å¤§å° (long=æ­£, short=è´Ÿ)
```

**å…³é”®æ–¹æ³•**ï¼š
- `update_from_event(event)`: æ ¹æ®äº‹ä»¶æ›´æ–°æŒä»“
  - POSITION_UPDATE: ä»APIæŒä»“å¯¹è´¦
  - ORDER_FILLED: ä»è®¢å•æˆäº¤æœ¬åœ°é¢„è®¡ç®—
- `_update_position(api_position)`: ä»APIæŒä»“æ›´æ–°
- `_update_position_from_order(order_filled)`: ä»è®¢å•æˆäº¤æ›´æ–°
- `_calculate_pnl(position, current_price)`: è®¡ç®—ç›ˆäº
  - å¤šå¤´: (å½“å‰ä»· - å¼€ä»“ä»·) * æ•°é‡
  - ç©ºå¤´: (å¼€ä»“ä»· - å½“å‰ä»·) * æ•°é‡
- `update_target_position(symbol, side, size)`: æ›´æ–°ç­–ç•¥æœŸæœ›æŒä»“
- `_reconcile(api_position)`: å¯¹è´¦é€»è¾‘ï¼ˆShadow Ledgeræ ¸å¿ƒï¼‰
  - è®¡ç®—æœŸæœ›æŒä»“ä¸å®é™…æŒä»“çš„å·®å¼‚
  - å¦‚æœå·®å¼‚è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤10%ï¼‰ï¼Œè§¦å‘åŒæ­¥
  - å†·å´æ—¶é—´æ£€æŸ¥ï¼ˆé»˜è®¤60ç§’ï¼‰
- `check_sync_needed(symbol)`: æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
- **`cancel_all_stop_loss_orders(symbol)`**: å–æ¶ˆæ‰€æœ‰æ­¢æŸå•ï¼ˆå¹½çµå•é˜²æŠ¤ï¼‰

**å¯¹è´¦é€»è¾‘ï¼ˆShadow Ledgerï¼‰**ï¼š
```
1. è·å–ç­–ç•¥æœŸæœ›æŒä»“: {symbol: {side, size, timestamp}}
2. è·å–APIå®é™…æŒä»“: {symbol: signed_size}
3. è®¡ç®—å·®é¢: delta = target_signed_size - actual_signed_size
4. è®¡ç®—åå·®ç™¾åˆ†æ¯”: diff_pct = abs(delta) / abs(target_signed_size)
5. å¦‚æœ diff_pct > threshold (10%) â†’ è§¦å‘åŒæ­¥
6. å†·å´æ—¶é—´æ£€æŸ¥ (60ç§’)
```

**å¹½çµå•é˜²æŠ¤é€»è¾‘**ï¼š
```
1. ç›‘å¬ POSITION_UPDATE äº‹ä»¶
2. æ£€æµ‹æŒä»“å½’é›¶ (abs(size) < 0.001)
3. è§¦å‘ cancel_all_stop_loss_orders()
4. æ’¤é”€æ‰€æœ‰è¯¥äº¤æ˜“å¯¹çš„æŒ‚å•
5. å‘å¸ƒ ORDER_CANCELLED äº‹ä»¶
```

---

### 3.3 ç½‘å…³æ¨¡å— (src/gateways/)

#### 3.3.1 BaseGateway (åŸºç±»)
**æ–‡ä»¶**ï¼šbase_gateway.py

**æŠ½è±¡æ–¹æ³•**ï¼š
- `connect()`: è¿æ¥ç½‘å…³
- `disconnect()`: æ–­å¼€ç½‘å…³
- `is_connected()`: æ£€æŸ¥è¿æ¥çŠ¶æ€
- `get_balance()`: è·å–ä½™é¢
- `get_positions()`: è·å–æŒä»“
- `place_order()`: ä¸‹å•
- `cancel_order()`: æ’¤å•
- `get_kline()`: è·å–Kçº¿

#### 3.3.2 OkxRestGateway (OKX REST API)
**æ–‡ä»¶**ï¼šokx/rest_api.py

**å…³é”®ç‰¹æ€§**ï¼š
- æŒä¹…Sessionå¤ç”¨ï¼ˆTCP Keep-Aliveï¼‰
- è‡ªåŠ¨OKX V5 APIç­¾åï¼ˆä½¿ç”¨OkxSignerï¼‰
- å®Œæ•´çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†
- ä½å»¶è¿Ÿï¼Œé«˜ååé‡
- ç»Ÿä¸€çš„Kçº¿è·å–åŠŸèƒ½
- **æ”¯æŒæ­¢æŸå•**ï¼šé€šè¿‡conditionalè®¢å•ç±»å‹å®ç°stop_market

**æ ¸å¿ƒç±»**ï¼š
```python
class OkxRestGateway(RestGateway):
    def __init__(self, api_key, secret_key, passphrase,
                 base_url="https://www.okx.com",
                 use_demo=False, timeout=10, event_bus=None)
```

**HTTPè¯·æ±‚æµç¨‹**ï¼š
```
1. åˆ›å»ºæŒä¹…åŒ–ClientSession
   - limit=100
   - ttl_dns_cache=300
   - keepalive_timeout=30
   - enable_cleanup_closed=True

2. ç”Ÿæˆè¯·æ±‚å¤´ï¼ˆä½¿ç”¨OkxSignerï¼‰
   - timestamp: ISOæ ¼å¼
   - sign: HMAC-SHA256ç­¾å
   - OK-ACCESS-KEY/PASSPHRASE
   - x-simulated-trading: 1 (æ¨¡æ‹Ÿæ¨¡å¼)

3. å‘é€HTTPè¯·æ±‚
   - GET: /api/v5/account/balance
   - GET: /api/v5/account/positions
   - POST: /api/v5/trade/order
   - POST: /api/v5/trade/cancel-order
   - GET: /api/v5/market/candles
   - POST: /api/v5/account/set-leverage

4. è§£æå“åº”
   - æ£€æŸ¥HTTPçŠ¶æ€ç 
   - æ£€æŸ¥APIé”™è¯¯ç 
   - å‘å¸ƒäº‹ä»¶ï¼ˆawait publish_eventï¼‰
```

**ä¸‹å•å­—æ®µç™½åå•**ï¼ˆOKX V5 APIæ”¯æŒï¼‰ï¼š
```python
okx_order_fields = {
    'instId', 'tdMode', 'side', 'ordType', 'sz', 'px',
    'reduceOnly', 'clOrdId', 'ccy', 'posSide'
}
```

**â­ 2026å¹´1æœˆ13æ—¥ API å‚æ•°æ ¼å¼åŒ–ä¿®å¤**ï¼š
1. **æ•°é‡å‚æ•°å­—ç¬¦ä¸²åŒ–**ï¼ˆError 59002 ä¿®å¤ï¼‰ï¼š
   - **ä¿®å¤å‰**ï¼š`'sz': size_int` (æ•´æ•°)
   - **ä¿®å¤å**ï¼š`'sz': str(size_int)` (å­—ç¬¦ä¸²)
   - **æ•ˆæœ**ï¼šé¿å… "Parameter 'sz' must be string type" é”™è¯¯

2. **ä»·æ ¼å‚æ•°æ ¼å¼åŒ–**ï¼ˆError 51006 ä¿®å¤ï¼‰ï¼š
   - **ä¿®å¤å‰**ï¼š`'px': str(price)` (å¯èƒ½åŒ…å«è¿‡å¤šå°æ•°ä½)
   - **ä¿®å¤å**ï¼š
     ```python
     price_str = f"{price:.4f}"
     price_str = price_str.rstrip('0').rstrip('.')
     'px': price_str
     ```
   - **æ•ˆæœ**ï¼šå»æ‰å¤šä½™å°æ•°ä½ï¼Œé¿å… "price precision invalid" é”™è¯¯
   - **ç¤ºä¾‹**ï¼š145.23000001 â†’ "145.23"

3. **æ­¢æŸå•å‚æ•°å­—ç¬¦ä¸²åŒ–**ï¼š
   - `'slOrdPx': str(price) if price else ''`
   - `'tpOrdPx': str(tp_price)`
   - **æ•ˆæœ**ï¼šç¡®ä¿æ‰€æœ‰æ•°å€¼å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹

**æ­¢æŸå•å®ç°**ï¼š
```python
# å¤„ç†æ­¢æŸå•ï¼ˆstop_market / stop_limitï¼‰
if order_type in ['stop_market', 'stop_limit']:
    # OKX V5 ä½¿ç”¨ conditional è®¢å•ç±»å‹
    body['ordType'] = 'conditional'
    body['slTriggerType'] = 'last'
    body['slOrdPx'] = str(price)  # æ­¢æŸè§¦å‘ä»·æ ¼

    # æ¡ä»¶å•å¿…é¡»æŒ‡å®š posSide
    if side == 'sell':
        body['posSide'] = 'long'   # å¤šå¤´æ­¢æŸ
    else:
        body['posSide'] = 'short'  # ç©ºå¤´æ­¢æŸ
```

**è®¢å•IDç”Ÿæˆ**ï¼š
```python
# clOrdIdé™åˆ¶ï¼š1-32ä½å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿
prefix = strategy_id[:4].lower()
ts_suffix = str(int(time.time() * 1000))[-8:]
clOrdId = f"{prefix}{ts_suffix}"
```

#### 3.3.3 OkxSigner (ç­¾åå·¥å…·)
**æ–‡ä»¶**ï¼šokx/auth.py

**ç­¾åæ–¹æ³•**ï¼š
```python
sign(timestamp, request_method, request_path, body, secret_key):
    message = timestamp + request_method + request_path + body
    signature = base64.b64encode(
        hmac.new(secret_key.encode('utf-8'),
                message.encode('utf-8'),
                hashlib.sha256).digest()
    ).decode()
```

#### 3.3.4 WebSocketç½‘å…³
**æ–‡ä»¶**ï¼š
- okx/ws_base.pyï¼ˆWebSocketåŸºç±»ï¼‰
- okx/ws_public_gateway.pyï¼ˆå…¬å…±WebSocketï¼‰
- okx/ws_private_gateway.pyï¼ˆç§æœ‰WebSocketï¼‰

**åŠŸèƒ½**ï¼š
- è®¢é˜…å…¬å…±è¡Œæƒ…ï¼ˆTickæ•°æ®ï¼‰
- è®¢é˜…ç§æœ‰æ•°æ®ï¼ˆè®¢å•æ›´æ–°ã€æŒä»“æ›´æ–°ï¼‰
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- å¿ƒè·³ä¿æ´»

---

### 3.4 ç­–ç•¥æ¨¡å— (src/strategies/)

#### 3.4.1 BaseStrategy (ç­–ç•¥åŸºç±»)
**æ–‡ä»¶**ï¼šbase_strategy.py

**æ ¸å¿ƒè®¾è®¡**ï¼š
- ç­–ç•¥åªè´Ÿè´£äº¤æ˜“é€»è¾‘ï¼Œä¸å…³å¿ƒæ•°æ®æº
- é€šè¿‡äº‹ä»¶æ€»çº¿æ¥æ”¶å¸‚åœºæ•°æ®
- çº¯ç²¹çš„ç­–ç•¥å®ç°ï¼Œä¸åŒ…å«ç½‘ç»œé€šä¿¡
- **æ”¯æŒè‡ªå¸¦é£æ§é…ç½®ï¼ˆRiskProfileï¼‰**

**åŸºç±»æ¥å£**ï¼š
```python
class BaseStrategy(ABC):
    @abstractmethod
    async def on_tick(self, event: Event):
        """å¤„ç†Tickäº‹ä»¶ï¼ˆç­–ç•¥æ ¸å¿ƒæ–¹æ³•ï¼‰"""
        pass

    @abstractmethod
    async def on_signal(self, signal: Dict[str, Any]):
        """å¤„ç†ç­–ç•¥ä¿¡å·"""
        pass

    async def buy(self, symbol, size, order_type="market", price=None) -> bool
    async def sell(self, symbol, size, order_type="market", price=None) -> bool
    async def start(self)  # å¯åŠ¨ç­–ç•¥
    async def stop(self)   # åœæ­¢ç­–ç•¥
```

**é£æ§é…ç½®**ï¼š
- `self.risk_profile: RiskProfile` - ç­–ç•¥é£æ§é…ç½®
- åˆå§‹åŒ–æ—¶ä½¿ç”¨é»˜è®¤ä¿å®ˆé…ç½®ï¼ˆ1xæ æ†ï¼Œç¡¬ä»·æ ¼æ­¢æŸï¼‰
- `set_risk_profile(profile: RiskProfile)` - å­ç±»å¯è¦†ç›–é»˜è®¤é…ç½®
- `start()` æ–¹æ³•è‡ªåŠ¨æ³¨å†Œé£æ§é…ç½®åˆ° CapitalCommander

**ä¾¿æ·æ–¹æ³•**ï¼š
- `buy()`: ä¹°å…¥
- `sell()`: å–å‡º

**å†…éƒ¨æµç¨‹**ï¼ˆ_submit_orderï¼‰ï¼š
1. å†·å´æ£€æŸ¥ï¼ˆé»˜è®¤5ç§’ï¼‰
2. æ£€æŸ¥OrderManageræ˜¯å¦æ³¨å…¥
3. æ£€æŸ¥CapitalCommanderæ˜¯å¦æ³¨å…¥ â†’ èµ„é‡‘æ£€æŸ¥
4. æäº¤è®¢å•
5. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- ticks_received: æ”¶åˆ°çš„Tickæ•°
- signals_generated: ç”Ÿæˆçš„ä¿¡å·æ•°
- orders_submitted: æäº¤çš„è®¢å•æ•°

#### 3.4.2 ScalperV1 (æé€Ÿå‰¥å¤´çš®ç­–ç•¥) â­
**æ–‡ä»¶**ï¼šhft/scalper_v1.py

**ç­–ç•¥é€»è¾‘**ï¼š
- åŸºäºå¾®è§‚ç»“æ„å¤±è¡¡ï¼ˆMicro-Imbalanceï¼‰çš„è¶…çŸ­çº¿å‰¥å¤´çš®
- å®Œå…¨ä¸çœ‹Kçº¿ï¼Œåªå¤„ç†on_tick (Trade Stream)
- æé€Ÿè®¡ç®—ï¼šä½¿ç”¨åŸç”ŸPython floatç´¯åŠ æˆäº¤é‡
- Makeræ¨¡å¼ï¼šå¼€ä»“ä½¿ç”¨é™ä»·å•ï¼Œé™ä½æ‰‹ç»­è´¹ï¼Œå¹³ä»“ä½¿ç”¨å¸‚ä»·å•
- åŠ¨é‡è§¦å‘ï¼šå½“1ç§’å†…ä¹°å…¥é‡ > å–å‡ºé‡ * 3 ä¸”ä¹°å…¥é‡ > é˜ˆå€¼æ—¶ï¼Œç«‹å³é™ä»·æŒ‚å•
- å…‰é€Ÿç¦»åœºï¼š
  - æ­¢ç›ˆï¼š+0.2% ç«‹å³èµ°äºº
  - æ­¢æŸï¼š+5ç§’ä¸æ¶¨ç«‹å³èµ°äºº (Time Stop)

**â­ 2026å¹´1æœˆ15æ—¥é‡å¤§ä¿®å¤ï¼ˆHFT å†·å´æ—¶é—´å½»åº•ç§»é™¤ï¼‰**ï¼š

1. **è¯†åˆ«çœŸæ­£å†·å´æ¥æº**ï¼š
   - **é—®é¢˜**ï¼šæ—¥å¿—æ˜¾ç¤º"å†·å´ä¸­ï¼Œè·³è¿‡ä¸‹å•"æ¥è‡ª `BaseStrategy`ï¼Œè€Œé `ScalperV1`
   - **æ ¹æº**ï¼š`BaseStrategy._submit_order()` ä¸­ç¡¬ç¼–ç  `5.0` ç§’å†·å´
   - **æ•ˆæœ**ï¼šå³ä½¿ ScalperV1 è®¾ç½® `cooldown=0`ï¼Œä»ç„¶è¢«åŸºç±»çš„ç¡¬ç¼–ç é˜»æ­¢

2. **BaseStrategy æ·»åŠ å†·å´å‚æ•°æ”¯æŒ**ï¼š
   - **ä¿®æ”¹å‰**ï¼š`BaseStrategy.__init__()` ç¡¬ç¼–ç å†·å´æ£€æŸ¥
   - **ä¿®æ”¹å**ï¼šæ·»åŠ  `cooldown_seconds: float = 5.0` å‚æ•°
   - **ä¿å­˜é…ç½®**ï¼š`self._cooldown_period = cooldown_seconds`
   - **ä½¿ç”¨é…ç½®**ï¼š`_submit_order()` ä½¿ç”¨ `self._cooldown_period` æ›¿ä»£ç¡¬ç¼–ç 
   - **æ•ˆæœ**ï¼šæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®å†·å´æ—¶é—´

3. **ScalperV1 ä¼ é€’å†·å´å‚æ•°**ï¼š
   - **ä¿®æ”¹å‰**ï¼š`super().__init__(...)` ä¸ä¼ é€’ `cooldown_seconds`
   - **ä¿®æ”¹å**ï¼š`super().__init__(..., cooldown_seconds=cooldown_seconds)`
   - **æ•ˆæœ**ï¼šç¯å¢ƒå˜é‡ `SCALPER_COOLDOWN_SECOND` å¯ä»¥ç”Ÿæ•ˆ

4. **é…ç½®ä¼ é€’é“¾è·¯**ï¼š
   ```
   .env â†’ SCALPER_COOLDOWN_SECOND
     â†“
   main.py â†’ load_config_from_env() è¯»å–ç¯å¢ƒå˜é‡
     â†“
   ScalperV1.__init__() â†’ super().__init__(cooldown_seconds=...)
     â†“
   BaseStrategy.__init__() â†’ self._cooldown_period = cooldown_seconds
     â†“
   BaseStrategy._submit_order() â†’ ä½¿ç”¨ self._cooldown_period æ£€æŸ¥å†·å´
   ```

5. **åŒé‡ä¿é™©æœºåˆ¶**ï¼ˆä¿ç•™ï¼‰ï¼š
   - `ScalperV1.start()` æ–¹æ³•ä»ç„¶å¼ºåˆ¶è®¾ç½® `self.config.cooldown_seconds = 0`
   - **æ•ˆæœ**ï¼šå³ä½¿é…ç½®è¢«è¦†ç›–ï¼Œä¹Ÿä¼šåœ¨å¯åŠ¨æ—¶é‡ç½®
   - **è¯´æ˜**ï¼šç¡®ä¿ HFT ç­–ç•¥ç»å¯¹æ— å†·å´

**â­ 2026å¹´1æœˆ15æ—¥ Maker æ¨¡å¼ä¼˜åŒ–ï¼ˆæ’é˜Ÿå’Œè¿½å•ï¼‰**ï¼š

1. **æ’é˜Ÿæœºåˆ¶ï¼ˆScheme Aï¼‰**ï¼š
   - **ä¿®æ”¹å‰**ï¼šæŒ‚åœ¨ä¹°ä¸€ä»·ï¼ˆBest Bidï¼‰ï¼Œæ’åœ¨é˜Ÿåˆ—æœ«å°¾
   - **ä¿®æ”¹å**ï¼šä½¿ç”¨ `min(Best Bid + Tick, Best Ask - Tick)`
   - **é€»è¾‘**ï¼šåœ¨ä¹°ä¸€ä»·åŸºç¡€ä¸ŠåŠ ä¸€ä¸ªæœ€å°è·³åŠ¨å•ä½ï¼ˆ0.01 USDTï¼‰
   - **é™åˆ¶**ï¼šä¸è¶…è¿‡ `Best Ask - Tick`ï¼ˆä¿æŒ Maker èº«ä»½ï¼‰
   - **æ•ˆæœ**ï¼šæŠ¢å ç¬¬ä¸€æ’ä½ï¼Œæé«˜æˆäº¤æ¦‚ç‡

2. **è¿½å•æœºåˆ¶ï¼ˆScheme Cï¼‰**ï¼š
   - **ç›‘æ§æ¡ä»¶**ï¼š`Best Bid > My Order Price`ï¼ˆè¢«æŒ¤åˆ°é˜Ÿåˆ—åé¢ï¼‰
   - **è¿½å•é€»è¾‘**ï¼šæ’¤é”€æ—§è®¢å•ï¼Œä½¿ç”¨æ–°ä»·æ ¼é‡æ–°æŒ‚å•
   - **é£æ§ä¿æŠ¤**ï¼šæœ€å¤§è¿½å•è·ç¦» 0.1%ï¼Œé˜²æ­¢æ— é™è¿½é«˜
   - **æ•ˆæœ**ï¼šä¿æŒä¼˜å…ˆçº§ï¼Œè‡ªåŠ¨è¿½ä»·

**â­ 2026å¹´1æœˆ13æ—¥é‡å¤§ä¿®å¤**ï¼š

**ä¼˜åŒ–ç‰¹ç‚¹**ï¼š
- **O(1) æ—¶é—´å¤æ‚åº¦**ï¼šåªç»´æŠ¤ç´¯åŠ å™¨ï¼Œä¸åšä»»ä½•åˆ—è¡¨æ“ä½œ
- **é›¶å†å²æ•°æ®**ï¼šä¸å­˜å‚¨Ticksï¼Œåªç»´æŠ¤å½“å‰ç§’çš„æˆäº¤é‡
- **æé€Ÿè®¡ç®—**ï¼šæ¯ç§’é‡ç½®çª—å£ï¼Œæ¯”dequeå¿«å¾—å¤š
- **è½»é‡çº§ä¾èµ–**ï¼šä¸¥ç¦ä½¿ç”¨pandasï¼Œåªä½¿ç”¨åŸç”ŸPython

**é…ç½®ç±»**ï¼š
```python
@dataclass
class ScalperV1Config:
    symbol: str = "BTC-USDT-SWAP"
    imbalance_ratio: float = 3.0          # ä¹°é‡ > å–é‡ * ratio æ‰è§¦å‘
    min_flow_usdt: float = 1000.0        # æœ€å°æµé€Ÿï¼ˆUSDTï¼‰ï¼Œè¿‡æ»¤æ‚æ³¢
    take_profit_pct: float = 0.002       # æ­¢ç›ˆ 0.2%
    stop_loss_pct: float = 0.01          # ç¡¬æ­¢æŸ 1%
    time_limit_seconds: int = 5          # æ—¶é—´æ­¢æŸ 5 ç§’
    position_size: Optional[float] = None  # ä»“ä½å¤§å°ï¼ˆNone=åŸºäºé£é™©è®¡ç®—ï¼‰
```

**é£æ§é…ç½®**ï¼š
```python
RiskProfile(
    strategy_id="scalper_v1",
    max_leverage=5.0,                    # å…è®¸ 5 å€æ æ†
    stop_loss_type=StopLossType.TIME_BASED, # æ—¶é—´æ­¢æŸ
    time_limit_seconds=5,                  # 5 ç§’å¼ºåˆ¶å¹³ä»“
    single_loss_cap_pct=0.02,              # å•ç¬”æœ€å¤§äºæŸ 2%
    max_order_size_usdt=500.0,             # HFT å¿«è¿›å¿«å‡ºï¼Œå•ç¬”è¾ƒå°
    max_daily_loss_pct=0.05                 # æ¯æ—¥æœ€å¤§äºæŸ 5%
)
```

**æ ¸å¿ƒé€»è¾‘**ï¼ˆon_tickï¼‰ï¼š
```
1. çª—å£é‡ç½®ï¼ˆæ¯ç§’é‡ç½®ä¸€æ¬¡ï¼Œæ¯” deque å¿«å¾—å¤šï¼‰
   - now = time.time()
   - if now - self.vol_window_start >= 1.0:
       self.buy_vol = 0.0
       self.sell_vol = 0.0
       self.vol_window_start = now

2. ç´¯åŠ æˆäº¤é‡ï¼ˆåªåšåŠ æ³•ï¼Œæå¿«ï¼‰
   - trade = event.data
   - price = float(trade['price'])
   - size = float(trade['size'])
   - usdt_val = price * size
   - if trade['side'] == 'buy':
       self.buy_vol += usdt_val
   - else:
       self.sell_vol += usdt_val

3. è§¦å‘é€»è¾‘ï¼ˆä»…ç©ºä»“æ—¶æ£€æŸ¥ï¼‰
   - if (self.buy_vol > self.sell_vol * self.imbalance_ratio) and \
      (self.buy_vol > self.min_flow_usdt):
       - ç«‹å³å¼€ä»“ï¼
       - await self.buy(...)
```

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- total_trades: æ€»äº¤æ˜“æ¬¡æ•°
- win_trades: ç›ˆåˆ©æ¬¡æ•°
- loss_trades: äºæŸæ¬¡æ•°
- win_rate: èƒœç‡
- buy_vol_current: å½“å‰ä¹°é‡
- sell_vol_current: å½“å‰å–é‡
- imbalance_current: å½“å‰å¤±è¡¡æ¯”
- max_imbalance_seen: æœ€å¤§å¤±è¡¡æ¯”

#### 3.4.3 PullbackStrategy (è¶‹åŠ¿å›è°ƒç­–ç•¥)
**æ–‡ä»¶**ï¼štrend/pullback.py.bak âš ï¸ å·²ç¦ç”¨

**çŠ¶æ€**ï¼š
- **å·²ç¦ç”¨**ï¼šé‡å‘½åä¸º `pullback.py.bak`
- **åŸå› **ï¼šä¾èµ–pandaså’Œnumpyï¼Œéœ€è¦é‡æ„
- **è®¡åˆ’**ï¼šåç»­é‡æ„ä»¥é€‚é…v3.0æ¶æ„

**ç­–ç•¥é€»è¾‘**ï¼ˆåŸç‰ˆï¼‰ï¼š
- åŸºäºEMA 144åˆ¤æ–­å¤§è¶‹åŠ¿
- åœ¨ç‰›å¸‚èƒŒæ™¯ä¸‹ç­‰å¾…RSIè¶…å–ä¹°å…¥
- åœ¨ç†Šå¸‚èƒŒæ™¯ä¸‹ç­‰å¾…RSIè¶…ä¹°å–å‡º
- "ä¸æ­»é¸Ÿ"ä»“ä½ç®¡ç†ï¼ˆæ¯å•æœ€å¤šäº2%ï¼‰

---

### 3.5 é£æ§æ¨¡å— (src/risk/)

#### 3.5.1 RiskProfile (é£æ§é…ç½®æ–‡ä»¶)
**æ–‡ä»¶**ï¼šconfig/risk_profile.py

**æ ¸å¿ƒèŒè´£**ï¼š
- å®šä¹‰ç­–ç•¥çº§åˆ«çš„é£æ§é…ç½®
- å®ç°ç­–ç•¥ä¸é£æ§çš„è§£è€¦
- æ”¯æŒä¸åŒç­–ç•¥ç±»å‹çš„å·®å¼‚åŒ–é£æ§å‚æ•°

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class RiskProfile:
    """ç­–ç•¥é£æ§é…ç½®æ–‡ä»¶"""
    strategy_id: str

    # æ æ†é™åˆ¶
    max_leverage: float = 1.0          # è¯¥ç­–ç•¥å…è®¸çš„æœ€å¤§çœŸå®æ æ†

    # å•ç¬”é£æ§
    max_order_size_usdt: float = 1000.0 # å•ç¬”æœ€å¤§åä¹‰ä»·å€¼
    single_loss_cap_pct: float = 0.01   # å•ç¬”æœ€å¤§äºæŸå æ€»èµ„é‡‘æ¯”ä¾‹ (1% Rule)

    # æ­¢æŸæ¨¡å¼
    stop_loss_type: StopLossType = StopLossType.HARD_PRICE

    # HFT ç‰¹æœ‰é…ç½®
    time_limit_seconds: int = 0        # æŒä»“æœ€å¤§æ—¶é—´ (ç§’), 0ä¸ºä¸é™åˆ¶

    # æ¯æ—¥ç†”æ–­
    max_daily_loss_pct: float = 0.05   # å½“æ—¥ç´¯è®¡äºæŸè¶…è¿‡5%åœæ­¢è¯¥ç­–ç•¥

class StopLossType(Enum):
    """æ­¢æŸç±»å‹æšä¸¾"""
    HARD_PRICE = "hard_price"    # ç¡¬ä»·æ ¼æ­¢æŸï¼ˆä¼ ç»Ÿï¼‰
    TIME_BASED = "time_based"    # æ—¶é—´æ­¢æŸï¼ˆHFTä¸“ç”¨ï¼‰
    TRAILING = "trailing"        # ç§»åŠ¨æ­¢æŸï¼ˆè¶‹åŠ¿ä¸“ç”¨ï¼‰
```

**å…³é”®æ–¹æ³•**ï¼š
- `is_hft_style()`: åˆ¤æ–­æ˜¯å¦ä¸ºHFTé£æ ¼é…ç½®
- `is_trend_style()`: åˆ¤æ–­æ˜¯å¦ä¸ºè¶‹åŠ¿ç­–ç•¥é£æ ¼é…ç½®
- `is_conservative()`: åˆ¤æ–­æ˜¯å¦ä¸ºä¿å®ˆé…ç½®

**é»˜è®¤é…ç½®**ï¼š
- `DEFAULT_CONSERVATIVE_PROFILE`: ä¿å®ˆé»˜è®¤å€¼ï¼ˆ1xæ æ†ï¼Œç¡¬ä»·æ ¼æ­¢æŸï¼‰

#### 3.5.2 RiskConfig (é£æ§é…ç½®)
**æ–‡ä»¶**ï¼šrisk_config.py

**æ ¸å¿ƒèŒè´£**ï¼š
- å®šä¹‰å…¨å±€é£æ§å‚æ•°
- æœºæ„çº§èµ„é‡‘ç®¡ç†ç³»ç»Ÿçš„ç¡¬æ€§å‚æ•°é…ç½®

**å…³é”®é…ç½®**ï¼š
```python
@dataclass
class RiskConfig:
    # å•ç¬”äº¤æ˜“é£é™©æ§åˆ¶
    RISK_PER_TRADE_PCT: float = 0.01  # æ¯ç¬”äº¤æ˜“é£é™©ä¸è¶…è¿‡æ€»èµ„é‡‘çš„1%

    # æ æ†æ§åˆ¶
    MAX_GLOBAL_LEVERAGE: float = 3.0  # å…¨å±€çœŸå®æ æ†ä¸Šé™ï¼ˆç»å¯¹çº¢çº¿ï¼‰

    # å›æ’¤æ§åˆ¶
    MAX_DRAWDOWN_LIMIT: float = 0.15  # ç­–ç•¥æœ€å¤§å›æ’¤ç†”æ–­é˜ˆå€¼

    # æ­¢æŸä¿æŠ¤
    DEFAULT_STOP_LOSS_PCT: float = 0.02  # é»˜è®¤æ­¢æŸç™¾åˆ†æ¯”
    MIN_STOP_DISTANCE_PCT: float = 0.001  # æœ€å°æ­¢æŸä»·å·®ä¿æŠ¤
```

#### 3.5.3 PreTradeCheck (äº¤æ˜“å‰æ£€æŸ¥)
**æ–‡ä»¶**ï¼šrisk/pre_trade.py

**æ ¸å¿ƒèŒè´£**ï¼š
- åœ¨ä¸‹å•å‰æ‰§è¡Œé£é™©æ£€æŸ¥
- é˜²æ­¢å¼‚å¸¸äº¤æ˜“

**æ£€æŸ¥é¡¹**ï¼š
1. **å•ç¬”è®¢å•é‡‘é¢æ£€æŸ¥**ï¼š
   - é»˜è®¤é˜ˆå€¼ï¼š2000 USDT
   - è¶…è¿‡åˆ™æ‹’ç»

2. **ä¸‹å•é¢‘ç‡æ£€æŸ¥**ï¼š
   - é»˜è®¤é™åˆ¶ï¼š1ç§’å†… < 5å•
   - è¶…è¿‡åˆ™æ‹’ç»

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
def check(order: dict) -> tuple[bool, Optional[str]]:
    """
    è¿”å›: (æ˜¯å¦é€šè¿‡, æ‹’ç»åŸå› )
    """
    # 1. æ£€æŸ¥è®¢å•é‡‘é¢
    if amount_usdt > max_order_amount:
        return False, "è®¢å•é‡‘é¢è¶…é™"

    # 2. æ£€æŸ¥ä¸‹å•é¢‘ç‡
    self._clean_order_history(current_time)
    if recent_count >= max_frequency:
        return False, "ä¸‹å•é¢‘ç‡è¿‡é«˜"

    # 3. è®°å½•è®¢å•
    self._order_history[current_time] = order_id

    return True, None
```

**è®¢å•å†å²æ¸…ç†**ï¼š
- ä¿ç•™frequency_windowï¼ˆé»˜è®¤1ç§’ï¼‰å†…çš„è®¢å•
- è¶…æ—¶çš„è®¢å•è‡ªåŠ¨æ¸…ç†

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- total_checks: æ€»æ£€æŸ¥æ¬¡æ•°
- total_rejections: æ€»æ‹’ç»æ¬¡æ•°
- rejection_rate: æ‹’ç»ç‡
- recent_orders: è¿‘æœŸè®¢å•æ•°

---

## 4. å·¥å…·æ¨¡å— (src/utils/)

### 4.1 Logger (æ—¥å¿—ç³»ç»Ÿ)
**æ–‡ä»¶**ï¼šlogger.py
- æ”¯æŒå¤šçº§åˆ«æ—¥å¿—
- æ–‡ä»¶æ—¥å¿—è¾“å‡º
- æ§åˆ¶å°æ—¥å¿—è¾“å‡º

### 4.2 Config (é…ç½®ç®¡ç†)
**æ–‡ä»¶**ï¼šconfig.py
- ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®
- é…ç½®éªŒè¯
- é»˜è®¤å€¼å¤„ç†

### 4.3 Auth (è®¤è¯å·¥å…·)
**æ–‡ä»¶**ï¼šauth.py
- APIå¯†é’¥ç®¡ç†
- ç­¾åç”Ÿæˆ

### 4.4 Cache (ç¼“å­˜)
**æ–‡ä»¶**ï¼šcache.py
- å†…å­˜ç¼“å­˜
- Redisç¼“å­˜æ”¯æŒ

### 4.5 Math (æ•°å­¦å·¥å…·)
**æ–‡ä»¶**ï¼šmath.py âš ï¸ åŒ…å«pandas/numpyä¾èµ–

**è¯´æ˜**ï¼š
- ä½¿ç”¨pandaså’Œnumpyè¿›è¡ŒæŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- ä»…è¢«æ—§ç‰ˆç­–ç•¥ä½¿ç”¨ï¼ˆå·²ç¦ç”¨ï¼‰
- æ–°ç‰ˆç­–ç•¥ä½¿ç”¨åŸç”ŸPythonå®ç°

**ä¾èµ–**ï¼š
- pandas==2.2.3
- numpy==1.23.5

### 4.6 Volatility (æ³¢åŠ¨ç‡ä¼°ç®—å™¨) â­ NEW
**æ–‡ä»¶**ï¼švolatility.py

**æ ¸å¿ƒèŒè´£**ï¼š
- åŸºäºEMAçš„è½»é‡çº§æ³¢åŠ¨ç‡ä¼°ç®—
- ç”¨äºHFTç­–ç•¥å®æ—¶ä¼°ç®—æ³¢åŠ¨ç‡
- å®Œå…¨ä½¿ç”¨åŸç”ŸPythonï¼Œæ— pandas/numpyä¾èµ–

**æ ¸å¿ƒç±»**ï¼š
```python
class VolatilityEstimator:
    """æ³¢åŠ¨ç‡ä¼°ç®—å™¨ï¼ˆåŸºäºEMAçš„è½»é‡çº§å®ç°ï¼‰"""

    def __init__(self, alpha: float = 0.2,
                 initial_price: float = 0.0,
                 min_volatility_floor: float = 0.005):
        # alpha: EMAå¹³æ»‘å› å­
        # initial_price: åˆå§‹ä»·æ ¼
        # min_volatility_floor: æ³¢åŠ¨ç‡ä¸‹é™ï¼ˆé˜²æ­¢æ¨ªç›˜æ—¶æ æ†è¿‡å¤§ï¼‰

    def update_volatility(self, current_price: float,
                        previous_close: float = None) -> float:
        """æ›´æ–°æ³¢åŠ¨ç‡ä¼°ç®—"""
        # ä½¿ç”¨ç®€åŒ–å…¬å¼ï¼šåŸºäºä»·æ ¼å˜åŒ–çš„EMA

    def get_volatility(self) -> float:
        """è·å–å½“å‰æ³¢åŠ¨ç‡"""

    def calculate_atr_based_stop(self, entry_price: float,
                               atr_multiplier: float = 2.0,
                               atr: Optional[float] = None) -> float:
        """åŸºäºæ³¢åŠ¨ç‡è®¡ç®—æ­¢æŸä»·"""

    def reset(self):
        """é‡ç½®æ³¢åŠ¨ç‡ä¼°ç®—å™¨"""
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- ScalperV1ï¼šåŠ¨æ€æ­¢æŸè®¡ç®—
- SniperStrategyï¼šåŠ¨æ€æ­¢æŸè®¡ç®—
- å…¶ä»–HFTç­–ç•¥ï¼šå®æ—¶æ³¢åŠ¨ç‡ç›‘æ§

### 4.7 Time (æ—¶é—´å·¥å…·)
**æ–‡ä»¶**ï¼štime.py
- æ—¶é—´æˆ³è½¬æ¢
- æ—¶åŒºå¤„ç†
- å»¶è¿Ÿå·¥å…·

---

## 5. é…ç½®ç³»ç»Ÿ

### 5.1 é…ç½®æ–‡ä»¶ç»“æ„
```
config/
â”œâ”€â”€ base.json         # åŸºç¡€é…ç½® âš ï¸ åŒ…å«åƒµå°¸é…ç½®
â”œâ”€â”€ development.json   # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ docker-daemon.json # Dockeré…ç½®
â”œâ”€â”€ local.json        # æœ¬åœ°ç¯å¢ƒ
â”œâ”€â”€ production.json    # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ test.json        # æµ‹è¯•ç¯å¢ƒ
```

### 5.2 ç¯å¢ƒå˜é‡
**å¿…éœ€å˜é‡**ï¼š
- `OKX_API_KEY`: OKX APIå¯†é’¥
- `OKX_SECRET_KEY`: OKXå¯†é’¥
- `OKX_PASSPHRASE`: OKXå¯†ç çŸ­è¯­

**å¯é€‰å˜é‡**ï¼š
- `TOTAL_CAPITAL`: æ€»èµ„é‡‘ï¼ˆé»˜è®¤10000 USDTï¼‰
- `TRADING_SYMBOL`: äº¤æ˜“å¯¹ï¼ˆé»˜è®¤BTC-USDT-SWAPï¼‰
- `USE_DEMO`: æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿäº¤æ˜“ï¼ˆé»˜è®¤trueï¼‰
- `MAX_ORDER_AMOUNT`: æœ€å¤§å•ç¬”è®¢å•é‡‘é¢ï¼ˆé»˜è®¤2000 USDTï¼‰
- `MAX_FREQUENCY`: æœ€å¤§ä¸‹å•é¢‘ç‡ï¼ˆé»˜è®¤5å•/1sï¼‰
- `LOG_LEVEL`: æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤INFOï¼‰
---

## 6. æ•°æ®æµåˆ†æ

### 6.1 å¸‚åœºæ•°æ®æµ
```
WebSocketå…¬å…±ç½‘å…³
    â†“ è®¢é˜…è¡Œæƒ…
TICKäº‹ä»¶
    â†“ publish()
EventBusé˜Ÿåˆ—
    â†“ process_loop()
Strategy.on_tick()
    â†“ å¤„ç†é€»è¾‘
OrderManager.submit_order()
    â†“ é£æ§æ£€æŸ¥
Gateway.place_order()
    â†“ REST API
äº¤æ˜“æ‰€
```

### 6.2 è®¢å•æ•°æ®æµ
```
ç­–ç•¥ä¸‹å•è¯·æ±‚
    â†“
OrderManager.submit_order()
    â†“ é£æ§æ£€æŸ¥
OkxRestGateway.place_order()
    â†“ HTTP POST
äº¤æ˜“æ‰€è¿”å›è®¢å•ID
    â†“ æœ¬åœ°ä¿å­˜
EventBus.publish(ORDER_SUBMITTED)
    â†“
ç›‘å¬å™¨å¤„ç†:
  - CapitalCommander: é¢„ç•™èµ„é‡‘
  - OrderManager: æ›´æ–°çŠ¶æ€
```

### 6.3 è®¢å•æˆäº¤æµ
```
äº¤æ˜“æ‰€æ¨é€æˆäº¤äº‹ä»¶
    â†“ WebSocketç§æœ‰ç½‘å…³
EventBus.publish(ORDER_FILLED)
    â†“
ç›‘å¬å™¨å¤„ç†:
  - CapitalCommander: é‡Šæ”¾èµ„é‡‘/è®°å½•ç›ˆäº
  - OrderManager: æ›´æ–°è®¢å•çŠ¶æ€
  - PositionManager: æ›´æ–°æŒä»“
```

### 6.4 æŒä»“åŒæ­¥æµ
```
å®šæœŸæŸ¥è¯¢æŒä»“ï¼ˆREST APIï¼‰
    â†“
EventBus.publish(POSITION_UPDATE)
    â†“
PositionManager.update_from_event()
    â†“
å¯¹è´¦é€»è¾‘ _reconcile()
    â†“
æ£€æŸ¥æœŸæœ›æŒä»“ vs å®é™…æŒä»“
    â†“
å·®å¼‚è¶…è¿‡é˜ˆå€¼ï¼Ÿ
    â†“ YES
ç”ŸæˆåŒæ­¥è®¡åˆ’ï¼ˆRESYNCï¼‰
    â†“
ç­–ç•¥æ‰§è¡ŒåŒæ­¥æ“ä½œ
```

### 6.5 å¹½çµå•é˜²æŠ¤æµ
```
POSITION_UPDATEäº‹ä»¶ï¼ˆæŒä»“å½’é›¶ï¼‰
    â†“
PositionManager.update_from_event()
    â†“
æ£€æµ‹ size â‰ˆ 0
    â†“
è§¦å‘ cancel_all_stop_loss_orders()
    â†“
æ’¤é”€æ‰€æœ‰è¯¥äº¤æ˜“å¯¹çš„æŒ‚å•
    â†“
å‘å¸ƒ ORDER_CANCELLED äº‹ä»¶
    â†“
OrderManager å¤„ç†æ’¤å•ç¡®è®¤
```

---

## 7. ä¾èµ–åˆ†æ

### 7.1 æ ¸å¿ƒä¾èµ–
```
æ ¸å¿ƒæ¡†æ¶:
- asyncio: å¼‚æ­¥ç¼–ç¨‹ï¼ˆå†…ç½®ï¼‰
- aiohttp==3.10.5: HTTPå®¢æˆ·ç«¯
- websockets==13.1: WebSocketå®¢æˆ·ç«¯
- python-dotenv==1.0.0: ç¯å¢ƒå˜é‡ç®¡ç†

æ•°æ®å¤„ç†:
- numpy==1.23.5: æ•°å€¼è®¡ç®— âš ï¸ ä¿ç•™ï¼ˆutils/math.pyéœ€è¦ï¼‰
- âœ… pandas==2.2.3: å·²ç§»é™¤ï¼ˆèŠ‚çœ200-300MBå†…å­˜ï¼‰

éªŒè¯å’Œé…ç½®:
- pydantic==2.8.2: æ•°æ®éªŒè¯
- pydantic-settings==2.4.0: é…ç½®ç®¡ç†

å®‰å…¨:
- cryptography==42.0.8: åŠ å¯†å’Œç­¾å

ç›‘æ§:
- watchdog==5.0.2: æ–‡ä»¶ç›‘æ§

æµ‹è¯•:
- pytest==7.4.3: æµ‹è¯•æ¡†æ¶
- pytest-cov==4.1.0: è¦†ç›–ç‡
- pytest-asyncio==0.21.1: å¼‚æ­¥æµ‹è¯•
- pytest-mock==3.12.0: Mockå·¥å…·
```

### 7.2 æ¨¡å—ä¾èµ–å…³ç³»
```
main.py
    â†“
Engine (core/engine.py)
    â†“
EventBus (core/event_bus.py)
    â”œâ†’ CapitalCommander (oms/capital_commander.py)
    â”œâ†’ PositionManager (oms/position_manager.py)
    â”œâ†’ OrderManager (oms/order_manager.py)
    â”‚   â””â†’ PreTradeCheck (risk/pre_trade.py)
    â”œâ†’ OkxRestGateway (gateways/okx/rest_api.py)
    â”‚   â””â†’ OkxSigner (gateways/okx/auth.py)
    â”œâ†’ OkxPublicWsGateway (gateways/okx/ws_public_gateway.py)
    â”œâ†’ OkxPrivateWsGateway (gateways/okx/ws_private_gateway.py)
    â””â†’ Strategies
        â”œâ†’ BaseStrategy (strategies/base_strategy.py)
        â”œâ†’ ScalperV1 (strategies/hft/scalper_v1.py) â­ NEW âœ… æ— pandas
        â”œâ†’ DualEMAStrategy (strategies/trend/dual_ema.py) âœ… æ— pandas
        â””â†’ PullbackStrategy (strategies/trend/pullback.py.bak) âš ï¸ å·²ç¦ç”¨

å·¥å…·æ¨¡å—:
    â”œâ†’ VolatilityEstimator (utils/volatility.py) â­ NEW âœ… æ— pandas/numpy
    â””â†’ TechnicalIndicators (utils/math.py) âš ï¸ åŒ…å«pandas/numpy
```

### 7.3 ä¾èµ–ä¼˜åŒ–æˆæœ
**å·²ç§»é™¤**ï¼š
- âœ… pandas==2.2.3ï¼ˆèŠ‚çœ200-300MBå†…å­˜ï¼‰

**ä¿ç•™ä½†è½»é‡**ï¼š
- âœ… numpy==1.23.5ï¼ˆä»…100-150MBï¼Œutils/math.pyéœ€è¦ï¼‰

**æ–°å¢è½»é‡çº§å·¥å…·**ï¼š
- âœ… utils/volatility.pyï¼ˆå®Œå…¨æ— pandas/numpyä¾èµ–ï¼‰
  - SniperStrategyä½¿ç”¨
  - ScalperV1ä½¿ç”¨
  - æœªæ¥æ‰€æœ‰HFTç­–ç•¥ç»Ÿä¸€ä½¿ç”¨

---

## 8. å…³é”®æŠ€æœ¯ç‚¹

### 8.1 å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
- **æ ¸å¿ƒæ¡†æ¶**: asyncio
- **HTTPå®¢æˆ·ç«¯**: aiohttpï¼ˆæŒä¹…Sessionå¤ç”¨ï¼‰
- **WebSocket**: websocketsåº“
- **äº‹ä»¶å¾ªç¯**: ç»Ÿä¸€ç”±Engineç®¡ç†

### 8.2 äº‹ä»¶é©±åŠ¨æ¶æ„
- **EventBus**: è½»é‡çº§Pub/Sub
- **äº‹ä»¶é˜Ÿåˆ—**: asyncio.Queue (maxsize=10000)
- **äº‹ä»¶å¤„ç†å™¨**: å¼‚æ­¥å‡½æ•°ï¼Œå¯æ³¨å†Œå¤šä¸ª
- **é”™è¯¯å¤„ç†**: è‡ªåŠ¨æ•è·å¹¶å‘å¸ƒERRORäº‹ä»¶

### 8.3 ä¾èµ–æ³¨å…¥
- **ç»„ä»¶åˆå§‹åŒ–**: Engineç»Ÿä¸€ç®¡ç†
- **æ¥å£æ³¨å…¥**: EventBus, OrderManager, CapitalCommander
- **æ¾è€¦åˆ**: æ¨¡å—é—´é€šè¿‡EventBusé€šä¿¡

### 8.4 é£æ§æœºåˆ¶
- **äº¤æ˜“å‰æ£€æŸ¥**: PreTradeCheck
  - é‡‘é¢é™åˆ¶
  - é¢‘ç‡é™åˆ¶
- **èµ„é‡‘ç®¡ç†**: CapitalCommander
  - èµ„é‡‘åˆ†é…
  - è´­ä¹°åŠ›æ£€æŸ¥
  - ç›ˆäºè¿½è¸ª
  - ç­–ç•¥çº§é£æ§ï¼ˆRiskProfileï¼‰
- **æŒä»“å¯¹è´¦**: Shadow Ledger
  - æœŸæœ›æŒä»“ vs å®é™…æŒä»“
  - å·®å¼‚é˜ˆå€¼è§¦å‘åŒæ­¥
  - å†·å´æ—¶é—´é˜²æ­¢é¢‘ç¹åŒæ­¥
- **å¹½çµå•é˜²æŠ¤**: PositionManager
  - æŒä»“å½’é›¶è‡ªåŠ¨æ’¤å•
  - é˜²æ­¢æ­¢æŸå•"å¹½çµåŒ–"

### 8.5 ç­¾åè®¤è¯
- **ç®—æ³•**: HMAC-SHA256
- **å®ç°**: OkxSignerç±»
- **æ—¶æœº**: æ¯æ¬¡REST APIè¯·æ±‚å‰

### 8.6 æ€§èƒ½ä¼˜åŒ–
- **Sessionå¤ç”¨**: TCP Keep-Alive
- **è¿æ¥æ± **: aiohttp.TCPConnector (limit=100)
- **DNSç¼“å­˜**: ttl_dns_cache=300
- **å¼‚æ­¥éé˜»å¡**: æ‰€æœ‰IOæ“ä½œå¼‚æ­¥åŒ–
- **O(1)ç®—æ³•**: ScalperV1ä½¿ç”¨æç®€ç´¯åŠ å™¨

### 8.7 å†…å­˜ä¼˜åŒ–ï¼ˆé’ˆå¯¹1Gå†…å­˜ç¯å¢ƒï¼‰
- **ç§»é™¤pandas**: èŠ‚çœ200-300MB
- **é›¶å†å²æ•°æ®**: ScalperV1ä¸å­˜å‚¨Ticks
- **åŸç”ŸPython**: æ‰€æœ‰HFTç­–ç•¥ä½¿ç”¨åŸç”ŸPythonå®ç°
- **è½»é‡çº§å·¥å…·**: VolatilityEstimatoræ— é‡å‹ä¾èµ–
- **æ¸…ç†æ­»ä»£ç **: åˆ é™¤_legacy_trash/ç›®å½•

---

## 9. æµ‹è¯•æ¶æ„

### 9.1 æµ‹è¯•ç»“æ„
```
tests/
â”œâ”€â”€ conftest.py          # æµ‹è¯•é…ç½®
â”œâ”€â”€ conftest_fixed.py    # ä¿®å¤çš„é…ç½®
â”œâ”€â”€ run_all_tests.py     # è¿è¡Œæ‰€æœ‰æµ‹è¯•
â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_hft_integration.py
â”œâ”€â”€ stress/            # å‹åŠ›æµ‹è¯•
â”‚   â””â”€â”€ test_hft_stress.py
â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”œâ”€â”€ utils/             # æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ base_test_runner.py
â””â”€â”€ reports/           # æµ‹è¯•æŠ¥å‘Š
    â”œâ”€â”€ coverage.xml
    â”œâ”€â”€ benchmarks/
    â”œâ”€â”€ coverage/
    â””â”€â”€ html/coverage/  # HTMLè¦†ç›–ç‡æŠ¥å‘Š
```

### 9.2 æµ‹è¯•å·¥å…·
- pytest: æµ‹è¯•æ¡†æ¶
- pytest-cov: è¦†ç›–ç‡
- pytest-asyncio: å¼‚æ­¥æµ‹è¯•
- pytest-mock: Mockå·¥å…·

---

## 10. éƒ¨ç½²æ¶æ„

### 10.1 Dockeræ”¯æŒ
```
Dockerfile
docker-compose.yml
```

### 10.2 é…ç½®ç¯å¢ƒ
- base.json: åŸºç¡€é…ç½®
- development.json: å¼€å‘ç¯å¢ƒ
- production.json: ç”Ÿäº§ç¯å¢ƒ
- test.json: æµ‹è¯•ç¯å¢ƒ

### 10.3 è„šæœ¬å·¥å…·
```
scripts/
â”œâ”€â”€ start.py                   # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ cleanup_positions.py        # æ¸…ç†æŒä»“è„šæœ¬
â”œâ”€â”€ verify_deployment.py      # éƒ¨ç½²éªŒè¯
â”œâ”€â”€ test_strategy_tick.py     # ç­–ç•¥æµ‹è¯•
â”œâ”€â”€ test_ws_debug.py          # WebSocketè°ƒè¯•
â”œâ”€â”€ test_ws_gateway.py        # WebSocketç½‘å…³æµ‹è¯•
â”œâ”€â”€ test_ws_raw.py          # åŸå§‹WebSocketæµ‹è¯•
â”œâ”€â”€ debug_auth.py           # è®¤è¯è°ƒè¯•
â””â”€â”€ deployment/deploy.sh     # éƒ¨ç½²è„šæœ¬
```

---

## 11. é—ç•™ä»£ç ç®¡ç†

### 11.1 _legacy_trashç›®å½•
**çŠ¶æ€**: âœ… å·²åˆ é™¤ï¼ˆ2026å¹´1æœˆ12æ—¥ï¼‰

**åŸå†…å®¹**ï¼š
```
_legacy_trash/
â”œâ”€â”€ circuit_breaker_hft.py
â”œâ”€â”€ dependencies.py
â”œâ”€â”€ emergency_actions.py
â”œâ”€â”€ environment_utils.py
â”œâ”€â”€ main_monolith.py
â”œâ”€â”€ order_checks.py
â”œâ”€â”€ shadow_ledger.py
â”œâ”€â”€ data_manager/
â”œâ”€â”€ executor/
â”œâ”€â”€ high_frequency/
â”œâ”€â”€ monitoring/
â”œâ”€â”€ risk_manager/
â””â”€â”€ strategy_engine/
```

**è¯´æ˜**ï¼šè¿™äº›æ˜¯æ—§ç‰ˆæœ¬ä»£ç ï¼Œå·²æ•´åˆåˆ°src/ç›®å½•ä¸‹ã€‚ä¸ºæ¸…ç†é¡¹ç›®æ¶æ„ï¼Œå·²å®Œå…¨åˆ é™¤è¯¥ç›®å½•ã€‚

**å»ºè®®**ï¼šå¦‚éœ€å‚è€ƒæ—§ä»£ç ï¼Œè¯·ä»Gitå†å²è®°å½•ä¸­æŸ¥çœ‹ã€‚

---

## 12. ç³»ç»Ÿå¯åŠ¨æµç¨‹

```
main.py
    â†“
1. é…ç½®æ—¥å¿—ç³»ç»Ÿ
    â†“
2. åŠ è½½ç¯å¢ƒå˜é‡
    â†“
3. ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®
    â†“
4. åˆ›å»ºEngineå®ä¾‹
    â†“
5. engine.initialize():
    5.1 åˆ›å»ºEventBus
    5.2 åˆ›å»ºOMSç»„ä»¶
    5.3 åˆ›å»ºGateways
    5.4 åˆ›å»ºé£æ§æ£€æŸ¥å™¨
    5.5 åˆ›å»ºOrderManagerï¼ˆæ³¨å…¥é£æ§ï¼‰
    5.6 åŠ è½½Strategies
    5.7 æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
    5.8 åˆ†é…ç­–ç•¥èµ„é‡‘
    â†“
6. engine.start():
    6.1 è¿æ¥Gateways
    6.2 è®¾ç½®æ æ†ï¼ˆ10xï¼‰
    6.3 å¯åŠ¨Strategies
    6.4 è®¾ç½®ä¿¡å·å¤„ç†ï¼ˆCtrl+Cï¼‰
    6.5 è¿›å…¥ä¸»å¾ªç¯ï¼ˆwhile _runningï¼‰
    â†“
7. ç­‰å¾…é€€å‡ºä¿¡å·
    â†“
8. engine.stop():
    8.1 åœæ­¢Strategies
    8.2 æ–­å¼€Gateways
    8.3 åœæ­¢EventBus
    â†“
9. ä¼˜é›…é€€å‡º
```

---

## 13. å…³é”®æ•°æ®ç»“æ„æ±‡æ€»

### 13.1 è®¢å•æ•°æ®
```python
Order:
    order_id: str
    symbol: str
    side: str (buy/sell)
    order_type: str (market/limit/ioc/stop_market)
    size: float
    price: float
    filled_size: float
    status: str (pending/live/filled/cancelled/rejected)
    strategy_id: str
    raw: dict (åŸå§‹APIæ•°æ®)
```

### 13.2 æŒä»“æ•°æ®
```python
Position:
    symbol: str
    side: str (long/short)
    size: float
    entry_price: float
    unrealized_pnl: float
    leverage: int
    raw: dict
    signed_size: float (æ­£=long, è´Ÿ=short)
```

### 13.3 èµ„é‡‘æ•°æ®
```python
StrategyCapital:
    allocated: float    # åˆ†é…èµ„é‡‘
    used: float         # å·²ä½¿ç”¨èµ„é‡‘
    profit: float       # ç´¯è®¡ç›ˆäº
    available: float   # å¯ç”¨èµ„é‡‘
```

### 13.4 äº‹ä»¶æ•°æ®
```python
Event:
    type: EventType
    data: dict
    source: str
```

---

## 14. é£é™©æ§åˆ¶ä½“ç³»

### 14.1 å¤šå±‚é£æ§æ¶æ„
```
ç¬¬ä¸€å±‚ï¼šäº¤æ˜“å‰æ£€æŸ¥ï¼ˆPreTradeCheckï¼‰
    - é‡‘é¢é™åˆ¶
    - é¢‘ç‡é™åˆ¶

ç¬¬äºŒå±‚ï¼šç­–ç•¥çº§é£æ§ï¼ˆRiskProfileï¼‰
    - ç­–ç•¥æœ€å¤§æ æ†é™åˆ¶
    - å•ç¬”è®¢å•é‡‘é¢é™åˆ¶
    - æ­¢æŸç±»å‹é…ç½®
    - æ¯æ—¥ç†”æ–­æ¯”ä¾‹
    - æ—¶é—´æ­¢æŸï¼ˆHFTä¸“ç”¨ï¼‰

ç¬¬ä¸‰å±‚ï¼šèµ„é‡‘ç®¡ç†ï¼ˆCapitalCommanderï¼‰
    - è´­ä¹°åŠ›æ£€æŸ¥
    - èµ„é‡‘åˆ†é…
    - ç›ˆäºè¿½è¸ª
    - å…¨å±€æ æ†ä¸Šé™ï¼ˆ3xï¼Œæœ€åä¸€é“é˜²çº¿ï¼‰

ç¬¬å››å±‚ï¼šæŒä»“å¯¹è´¦ï¼ˆShadow Ledgerï¼‰
    - æœŸæœ›æŒä»“ vs å®é™…æŒä»“
    - å·®å¼‚é˜ˆå€¼è§¦å‘åŒæ­¥
    - å†·å´æ—¶é—´é˜²æ­¢é¢‘ç¹åŒæ­¥

ç¬¬äº”å±‚ï¼šå¹½çµå•é˜²æŠ¤
    - æŒä»“å½’é›¶è‡ªåŠ¨æ’¤å•
    - é˜²æ­¢æ­¢æŸå•"å¹½çµåŒ–"
```

### 14.2 é£æ§å‚æ•°

#### 14.2.1 å…¨å±€é£æ§å‚æ•°ï¼ˆRiskConfigï¼‰
```python
# PreTradeCheck
max_order_amount: 2000.0 USDT
max_frequency: 5 å• / 1 ç§’
frequency_window: 1.0 ç§’

# CapitalCommander
total_capital: 10000.0 USDT
MAX_GLOBAL_LEVERAGE: 3.0  # å…¨å±€æ æ†ä¸Šé™ï¼ˆç»å¯¹çº¢çº¿ï¼‰

# PositionManager (Shadow Ledger)
sync_threshold_pct: 10%  # å·®å¼‚é˜ˆå€¼
sync_cooldown_seconds: 60  # åŒæ­¥å†·å´æ—¶é—´
```

#### 14.2.2 ç­–ç•¥çº§é£æ§å‚æ•°ï¼ˆRiskProfileï¼‰
```python
@dataclass
class RiskProfile:
    # æ æ†é™åˆ¶
    max_leverage: float = 1.0          # ç­–ç•¥å…è®¸çš„æœ€å¤§æ æ†
    max_order_size_usdt: float = 1000.0 # å•ç¬”æœ€å¤§åä¹‰ä»·å€¼

    # å•ç¬”é£æ§
    single_loss_cap_pct: float = 0.01   # å•ç¬”æœ€å¤§äºæŸå æ¯”

    # æ­¢æŸæ¨¡å¼
    stop_loss_type: StopLossType = StopLossType.HARD_PRICE
    #   - HARD_PRICE: ç¡¬ä»·æ ¼æ­¢æŸï¼ˆä¼ ç»Ÿï¼‰
    #   - TIME_BASED: æ—¶é—´æ­¢æŸï¼ˆHFTä¸“ç”¨ï¼‰
    #   - TRAILING: ç§»åŠ¨æ­¢æŸï¼ˆè¶‹åŠ¿ä¸“ç”¨ï¼‰

    # HFT ç‰¹æœ‰é…ç½®
    time_limit_seconds: int = 0        # æŒä»“æœ€å¤§æ—¶é—´ (ç§’), 0ä¸ºä¸é™åˆ¶

    # æ¯æ—¥ç†”æ–­
    max_daily_loss_pct: float = 0.05   # å½“æ—¥ç´¯è®¡äºæŸè¶…è¿‡5%åœæ­¢è¯¥ç­–ç•¥
```

### 14.3 ç­–ç•¥é£æ§é…ç½®ç¤ºä¾‹

#### 14.3 ScalperV1 é…ç½®ï¼ˆæ¿€è¿›HFTï¼‰
```python
RiskProfile(
    strategy_id="scalper_v1",
    max_leverage=5.0,                    # å…è®¸ 5 å€æ æ†
    stop_loss_type=StopLossType.TIME_BASED, # æ—¶é—´æ­¢æŸ
    time_limit_seconds=5,                  # 5 ç§’å¼ºåˆ¶å¹³ä»“
    single_loss_cap_pct=0.02,              # å•ç¬”æœ€å¤§äºæŸ 2%
    max_order_size_usdt=500.0,             # HFT å¿«è¿›å¿«å‡ºï¼Œå•ç¬”è¾ƒå°
    max_daily_loss_pct=0.05                 # æ¯æ—¥æœ€å¤§äºæŸ 5%
)
```

---

## 15. æ€§èƒ½æŒ‡æ ‡

### 15.1 å¹¶å‘èƒ½åŠ›
- è¿æ¥æ± å¤§å°: 100
- äº‹ä»¶é˜Ÿåˆ—å¤§å°: 10000
- WebSocketè‡ªåŠ¨é‡è¿
- Session Keep-Alive: 30ç§’

### 15.2 å»¶è¿Ÿä¼˜åŒ–
- DNSç¼“å­˜: 300ç§’
- å¼‚æ­¥éé˜»å¡IO
- æŒä¹…Sessionå¤ç”¨
- TCP Keep-Alive

### 15.3 å†…å­˜ä¼˜åŒ–ï¼ˆé’ˆå¯¹1Gå†…å­˜ç¯å¢ƒï¼‰
- **ç§»é™¤pandas**: èŠ‚çœ200-300MB
- **åˆ é™¤æ­»ä»£ç **: å‡å°‘30%é¡¹ç›®ä½“ç§¯
- **é›¶å†å²æ•°æ®**: ScalperV1ä¸å­˜å‚¨Ticks
- **åŸç”ŸPython**: æ‰€æœ‰HFTç­–ç•¥ä½¿ç”¨åŸç”ŸPython
- **è½»é‡çº§å·¥å…·**: VolatilityEstimatoræ— é‡å‹ä¾èµ–

---

## 16. æ€»ç»“

### 16.1 æ¶æ„ä¼˜åŠ¿
1. **äº‹ä»¶é©±åŠ¨**: æ¨¡å—è§£è€¦ï¼Œæ˜“äºæ‰©å±•
2. **å¼‚æ­¥ä¼˜å…ˆ**: é«˜æ€§èƒ½ï¼Œä½å»¶è¿Ÿ
3. **ä¾èµ–æ³¨å…¥**: æ¾è€¦åˆï¼Œæ˜“æµ‹è¯•
4. **å¤šå±‚é£æ§**: èµ„é‡‘ã€é¢‘ç‡ã€æŒä»“å…¨é¢ä¿æŠ¤
5. **ç­–ç•¥åˆ†ç¦»**: äº¤æ˜“é€»è¾‘ç‹¬ç«‹ï¼Œå¿«é€Ÿè¿­ä»£
6. **è½»é‡åŒ–**: é’ˆå¯¹1Gå†…å­˜ç¯å¢ƒä¼˜åŒ–

### 16.2 æ ¸å¿ƒç‰¹ç‚¹
- æ”¯æŒå¤šç­–ç•¥å¹¶å‘è¿è¡Œ
- å®æ—¶æŒä»“å¯¹è´¦ï¼ˆShadow Ledgerï¼‰
- å®Œæ•´çš„èµ„é‡‘ç®¡ç†ä½“ç³»
- è‡ªåŠ¨åŒ–é£æ§æœºåˆ¶
- æ”¯æŒæ¨¡æ‹Ÿå’Œå®ç›˜äº¤æ˜“
- **å¹½çµå•é˜²æŠ¤**ï¼šæŒä»“å½’é›¶è‡ªåŠ¨æ’¤å•
- **æ­¢æŸå•æ”¯æŒ**ï¼šé€šè¿‡conditionalè®¢å•ç±»å‹å®ç°
- **ç­–ç•¥çº§é£æ§**ï¼šRiskProfileå·®å¼‚åŒ–é…ç½®
- **è½»é‡çº§ä¾èµ–**ï¼šç§»é™¤pandasï¼ŒèŠ‚çœ200-300MBå†…å­˜

### 16.3 æŠ€æœ¯æ ˆ
- Python 3.x
- asyncio + aiohttp
- OKX V5 API
- pytestæµ‹è¯•æ¡†æ¶
- Dockeréƒ¨ç½²æ”¯æŒ
- **åŸç”ŸPythonä¼˜å…ˆ**ï¼šHFTç­–ç•¥æ— é‡å‹ä¾èµ–

### 16.4 å¯ç”¨ç­–ç•¥ï¼ˆ2026å¹´1æœˆ12æ—¥ï¼‰
| ç­–ç•¥ | çŠ¶æ€ | ä¾èµ– | é£æ§é£æ ¼ |
|------|------|------|-----------|
| **ScalperV1** | âœ… å¯ç”¨ | âœ… æ— pandas/numpy | HFTï¼ˆ5xæ æ†ï¼Œæ—¶é—´æ­¢æŸï¼‰|
| **PullbackStrategy** | âš ï¸ å·²ç¦ç”¨ | âŒ æœ‰pandas/numpy | è¶‹åŠ¿ï¼ˆå¾…é‡æ„ï¼‰|

### 16.5 å…³é”®ä¿®å¤å’Œä¼˜åŒ–ï¼ˆ2026å¹´1æœˆ14æ—¥ï¼‰

#### 2026å¹´1æœˆ14æ—¥ï¼ˆç´§æ€¥ä¿®å¤ï¼šç­–ç•¥äº‹ä»¶æ³¨å†Œå’Œé£æ§é™åˆ¶ï¼‰
32. **â­ NEW: ä¿®å¤ Engine ç­–ç•¥äº‹ä»¶æ³¨å†Œç¼ºå¤±**ï¼šåœ¨ `_register_event_handlers` æ–¹æ³•ä¸­æ·»åŠ ç­–ç•¥äº‹ä»¶æ³¨å†Œé€»è¾‘
   - ä¸ºæ¯ä¸ªç­–ç•¥æ³¨å†Œ `EventType.TICK` äº‹ä»¶ï¼ˆé©±åŠ¨ç­–ç•¥æ ¸å¿ƒé€»è¾‘ï¼‰
   - ä¸ºæ¯ä¸ªç­–ç•¥æ³¨å†Œ `EventType.ORDER_FILLED` äº‹ä»¶ï¼ˆé©±åŠ¨æŒä»“æ›´æ–°å’ŒæŒ‚å•ç®¡ç†ï¼‰
   - æ·»åŠ ç­–ç•¥ä¸ºç©ºçš„æ£€æŸ¥å’Œæ—¥å¿—è¾“å‡º
   - **æ•ˆæœ**ï¼šä¿®å¤ç­–ç•¥æ— æ³•æ¥æ”¶è¡Œæƒ…æ•°æ®çš„é—®é¢˜

33. **â­ NEW: ä¼˜åŒ– ws_public_gateway é«˜é¢‘æ—¥å¿—**ï¼šç§»é™¤é«˜é¢‘æˆäº¤æ•°æ®å’Œè®¢å•ç°¿çš„ debug æ—¥å¿—
   - ç§»é™¤ `logger.debug(f"æ”¶åˆ° {len(data['data'])} ç¬”äº¤æ˜“æ•°æ®")`
   - ç§»é™¤ `logger.debug(f"æ”¶åˆ°æˆäº¤: {price:.2f} x {size:.4f} = {usdt_value:.2f} USDT")`
   - ç§»é™¤ `logger.debug(f"è®¢å•ç°¿æ›´æ–°: Bid1=..., Ask1=...")`
   - ä¿ç•™å¤§å•è­¦å‘Šï¼ˆâ‰¥10000 USDTï¼‰å’Œé”™è¯¯æ—¥å¿—
   - **æ•ˆæœ**ï¼šå‡å°‘æ—¥å¿—åˆ·å±ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½

34. **â­ NEW: ä¿®å¤ ScalperV1 ç­–ç•¥åˆå§‹åŒ–å´©æºƒ**ï¼šæ·»åŠ  `cooldown_seconds` å‚æ•°
   - åœ¨ `__init__` æ–¹æ³•ç­¾åä¸­æ·»åŠ  `cooldown_seconds: float = 10.0`
   - æ·»åŠ  `**kwargs` å®¹é”™æœºåˆ¶ï¼Œé˜²æ­¢æœªæ¥æ–°å¢å‚æ•°å¯¼è‡´å´©æºƒ
   - å°† `cooldown_seconds` ä¼ é€’åˆ° `ScalperV1Config`ï¼ˆè½¬æ¢ä¸º intï¼‰
   - æ·»åŠ æœªè¯†åˆ«å‚æ•°çš„è­¦å‘Šæ—¥å¿—
   - **æ•ˆæœ**ï¼šä¿®å¤ TypeError: unexpected keyword argument 'cooldown_seconds'

35. **â­ NEW: æå‡ CapitalCommander å•ä¸€èµ„äº§æ•å£é™åˆ¶**ï¼šä» 50% æå‡åˆ° 2000%
   - ä¿®æ”¹ `RiskConfig.MAX_SINGLE_SYMBOL_EXPOSURE` é»˜è®¤å€¼ä» `0.5` æ”¹ä¸º `20.0`
   - åœ¨ `calculate_safe_quantity` æ–¹æ³•ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
   - **æ•ˆæœ**ï¼šå…è®¸é«˜æ æ†äº¤æ˜“ï¼ˆ1006% æ•å£ä¸å†è¢«æ‹¦æˆªï¼‰

36. **â­ NEW: æ·»åŠ  CapitalCommander è°ƒè¯•æ—¥å¿—**ï¼šåœ¨ `calculate_safe_quantity` æ–¹æ³•ä¸­
   - æ·»åŠ  `logger.debug(f"ğŸ›¡ï¸ [æ•å£æ£€æŸ¥] {symbol}: å½“å‰æ•å£={symbol_exposure_ratio * 100:.1f}%, é™åˆ¶={self._risk_config.MAX_SINGLE_SYMBOL_EXPOSURE * 100:.1f}%")`
   - **æ•ˆæœ**ï¼šä¾¿äºç¡®è®¤é£æ§é™åˆ¶å€¼ï¼Œè¯Šæ–­é…ç½®é—®é¢˜

### 16.6 å…³é”®ä¿®å¤å’Œä¼˜åŒ–ï¼ˆ2026å¹´1æœˆ13æ—¥ï¼‰

#### 2026å¹´1æœˆ12æ—¥
1. **ä¿®å¤ OrderManager æ–¹æ³•å**ï¼šsubscribe â†’ register
2. **ä¿®å¤ PositionManager await**ï¼šç¡®ä¿äº‹ä»¶æ­£ç¡®å¤„ç†
3. **ä¿®å¤ publish_event await**ï¼šç¡®ä¿äº‹ä»¶æ­£ç¡®å‘é€
4. **æ·»åŠ æ­¢æŸå•æ”¯æŒ**ï¼šé€šè¿‡conditionalè®¢å•ç±»å‹
5. **æ·»åŠ å¹½çµå•é˜²æŠ¤**ï¼šæŒä»“å½’é›¶è‡ªåŠ¨æ’¤å•
6. **æ·»åŠ æµ‹è¯•è„šæœ¬**ï¼šç”Ÿäº§çº§è¡¥ä¸éªŒè¯
7. **â­ NEW: é‡æ„DualEMAStrategy**ï¼šç§»é™¤pandasä¾èµ–
8. **â­ NEW: åˆ›å»ºVolatilityEstimator**ï¼šè½»é‡çº§æ³¢åŠ¨ç‡ä¼°ç®—
9. **â­ NEW: å¼€å‘ScalperV1**ï¼šæé€Ÿå‰¥å¤´çš®ç­–ç•¥
10. **â­ NEW: ç§»é™¤pandasä¾èµ–**ï¼šèŠ‚çœ200-300MBå†…å­˜
11. **â­ NEW: åˆ é™¤_legacy_trash/**ï¼šæ¸…ç†æ­»ä»£ç 
12. **â­ NEW: ç¦ç”¨PullbackStrategy**ï¼šç­‰å¾…é‡æ„

#### 2026å¹´1æœˆ13æ—¥ï¼ˆScalperV1 å…¨é¢ä¿®å¤ï¼‰
13. **â­ NEW: ä¿®å¤ ScalperV1 UnboundLocalError**ï¼šåˆå§‹åŒ– `imbalance` å˜é‡
14. **â­ NEW: ä¿®å¤ Sniper ç­–ç•¥æŠ¢å èµ„é‡‘**ï¼šæ¸…ç©º main.py é»˜è®¤ç­–ç•¥åˆ—è¡¨
15. **â­ NEW: ä¿®å¤ Engine é»˜è®¤ç¡¬ç¼–ç é…ç½®**ï¼šæ¸…ç©º create_default_config çš„ strategies åˆ—è¡¨
16. **â­ NEW: ä¿®å¤ CapitalCommander é£æ§é…ç½®ç¼ºå¤±**ï¼šæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
17. **â­ NEW: ä¿®æ”¹ ScalperV1 é»˜è®¤äº¤æ˜“å¯¹**ï¼šä» BTC-USDT-SWAP æ”¹ä¸º SOL-USDT-SWAP
18. **â­ NEW: ä¿®æ”¹ ScalperV1 é»˜è®¤èµ„é‡‘**ï¼šä» 100.0 USDT æ”¹ä¸º 10000.0 USDT
19. **â­ NEW: æ·»åŠ ç¯å¢ƒå˜é‡è°ƒè¯•æ—¥å¿—**ï¼šå¯åŠ¨æ—¶æ‰“å°å…³é”®ç¯å¢ƒå˜é‡
20. **â­ NEW: ä¿®å¤ ScalperV1 Tick è¿‡æ»¤é€»è¾‘**ï¼šæ”¹ç”¨æ€»æˆäº¤é‡åˆ¤æ–­æ´»è·ƒåº¦ï¼Œä¸ä¸¢å¤±æµåŠ¨æ€§æ•°æ®
21. **â­ NEW: ä¿®å¤ ScalperV1 ä¸‹å•æ•°é‡é”™è¯¯**ï¼šå¼ºåˆ¶æ•´æ•°ï¼Œè‡³å°‘ 1ï¼ˆé¿å… 0.1 SOLï¼‰
22. **â­ NEW: ä¿®å¤ ScalperV1 ä¸‹å•ä»·æ ¼æ»å**ï¼šæº¢ä»· 0.1% Taker åƒå•ï¼ˆç¡®ä¿æˆäº¤ï¼‰
23. **â­ NEW: ä¿®å¤ OKX API å‚æ•°æ ¼å¼**ï¼šsz å’Œ px å­—ç¬¦ä¸²åŒ–ï¼ˆError 59002 å’Œ 51006ï¼‰

#### 2026å¹´1æœˆ13æ—¥ï¼ˆBaseStrategy è‡ªåŠ¨å…¨å¹³ä¿®å¤ï¼‰
24. **â­ NEW: æ·»åŠ  set_position_manager æ–¹æ³•**ï¼šæ”¯æŒä¾èµ–æ³¨å…¥
25. **â­ NEW: å®Œå–„ get_position æ–¹æ³•**ï¼šå®‰å…¨è®¿é—®ï¼Œå¤„ç†æœªæ³¨å…¥æƒ…å†µ
26. **â­ NEW: é‡å†™ _submit_order**ï¼šæ”¯æŒ size=None è‡ªåŠ¨å…¨å¹³
27. **â­ NEW: Engine æ³¨å…¥ PositionManager**ï¼šç¡®ä¿æ‰€æœ‰ç­–ç•¥å¯ç”¨

#### 2026å¹´1æœˆ13æ—¥ï¼ˆScalperV1 æœ¬åœ°æŒä»“è®°å½•ä¿®å¤ï¼‰
28. **â­ NEW: æ·»åŠ  local_pos_size å˜é‡**ï¼šæœ¬åœ°å¼ºæŒä»“è®°å½•ï¼Œä¸ä¾èµ–å¤–éƒ¨
29. **â­ NEW: å¼€ä»“æ—¶è®°å½•æ•°é‡**ï¼šç«‹å³è®°å½•æŒä»“å¤§å°
30. **â­ NEW: å¹³ä»“æ—¶ä½¿ç”¨æœ¬åœ°æ•°é‡**ï¼šæ˜¾å¼ä¼ å…¥ size=self.local_pos_size
31. **â­ NEW: å¹³ä»“åé‡ç½®è®°å½•**ï¼šlocal_pos_size = 0.0

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026å¹´1æœˆ13æ—¥
**é¡¹ç›®ç‰ˆæœ¬**: Athena OS v3.0
**é€‚ç”¨å¯¹è±¡**: AIç†è§£å’Œæ¶æ„åˆ†æ
**ç¯å¢ƒè¦æ±‚**: 1æ ¸ 1G å†…å­˜ï¼Œ1ms å»¶è¿Ÿ
