[pytest]
# pytest配置文件
# Pytest Configuration File

# 测试文件搜索路径
testpaths = tests

# 测试文件命名模式
python_files = test_*.py *_test.py

# 测试类命名模式
python_classes = Test*

# 测试函数命名模式
python_functions = test_*

# 命令行选项（在每次运行时自动应用）
addopts =
    # 详细输出
    -v

    # 严格标记模式
    --strict-markers

    # 简短的traceback格式
    --tb=short

    # 显示测试耗时最慢的10个
    --durations=10

    # 覆盖率配置
    --cov=src
    --cov-report=term-missing:skip-covered
    --cov-report=html:tests/reports/html/coverage
    --cov-report=xml:tests/reports/coverage.xml

    # 异步测试模式
    --asyncio-mode=auto

    # 警告配置
    -W ignore::DeprecationWarning

# 最小Python版本
minversion = 7.0

# 标记定义（已在conftest.py中定义，这里作为备份）
markers =
    unit: 单元测试
    integration: 集成测试
    system: 系统测试
    slow: 慢速测试
    performance: 性能测试
    security: 安全测试
    database: 数据库相关测试
    redis: Redis相关测试
    external_api: 外部API测试
    benchmark: 基准测试

# 覆盖率配置（与.coveragerc保持一致）
[coverage:run]
source = src
omit =
    */tests/*
    */test_*
    *_test.py
    */site-packages/*
    */dist-packages/*
    */__pycache__/*
    */migrations/*
    */config/*
    scripts/*
    docs/*
    frontend/*
    logs/*
    setup.py
    conftest.py
    main_monolith.py

branch = True
show_missing = True
parallel = True

[coverage:report]
exclude_lines =
    pragma: no cover
    except:
    except ImportError:
    except Exception:
    raise NotImplementedError
    @abstract*
    if TYPE_CHECKING:
    assert
    pass
    """*"""
    '''*'''

precision = 2
skip_empty = True
sort = Cover

[coverage:html]
directory = tests/reports/html/coverage
show_contexts = True
title = Athena Trader 测试覆盖率报告

[coverage:xml]
output = tests/reports/coverage.xml

[coverage:paths]
source =
    src/
    .tox/*/lib/python*/site-packages/src/
