# Athena Trader 环境变量配置示例
# 复制此文件为 .env 并填写你的真实配置

# ========== 基础配置 ==========
LOG_LEVEL=INFO
ACTIVE_STRATEGY=scalper_v2

# ========== 🚀 性能优化配置（阶段1优化）==========

# EventBus 性能监控开关
# 生产环境建议关闭以提升性能（可节省 15-20ms）
# 开发环境可设为 true 以进行性能分析
EVENT_BUS_ENABLE_LATENCY_TRACKING=false

# PositionSizer 详细日志开关
# 生产环境建议关闭以提升性能（可节省 10-15ms）
# 开发环境可设为 true 以查看详细仓位计算过程
POSITION_SIZER_VERBOSE=false

# SignalGenerator 详细日志开关
# 生产环境建议关闭以提升性能（可节省 8-12ms）
# 开发环境可设为 true 以查看详细信号生成过程
SIGNAL_GENERATOR_VERBOSE=false

# ========== 资金配置 ==========
TOTAL_CAPITAL=10000.0
SCALPER_CAPITAL=10000.0

# ========== 交易对配置 ==========
TRADING_SYMBOL=DOGE-USDT-SWAP
SCALPER_SYMBOL=DOGE-USDT-SWAP

# ========== OKX API 配置 ==========
OKX_API_KEY=your_api_key_here
OKX_SECRET_KEY=your_secret_key_here
OKX_PASSPHRASE=your_passphrase_here

# ========== 模拟交易配置 ==========
USE_DEMO=true

# ========== ScalperV2 策略配置 ==========
# 基础策略参数
ENABLE_SCALPER_V2=true
SCALPER_TAKE_PROFIT_PCT=0.002
SCALPER_STOP_LOSS_PCT=0.01
SCALPER_TIME_LIMIT_SECONDS=30
SCALPER_COOLDOWN_SECONDS=0.1
SCALPER_LEVERAGE=5.0

# ========== ✨ 新增：自适应仓位管理配置 (Position Sizing) ==========

# 基础资金配置
# 基础仓位：总资金的百分比（默认 2%）
POSITION_SIZING_BASE_EQUITY_RATIO=0.02

# 最大杠杆倍数限制
POSITION_SIZING_MAX_LEVERAGE=5.0

# 最小下单金额（USDT），低于此值不会下单
POSITION_SIZING_MIN_ORDER_VALUE=10.0

# ========== 信号强度自适应配置 ==========

# 是否启用信号强度自适应（true/false）
POSITION_SIZING_SIGNAL_SCALING_ENABLED=true

# 正常不平衡阈值（倍数），达到此值使用 1.0 倍仓位
POSITION_SIZING_SIGNAL_THRESHOLD_NORMAL=5.0

# 激进不平衡阈值（倍数），达到此值使用 1.5 倍仓位
POSITION_SIZING_SIGNAL_THRESHOLD_AGGRESSIVE=10.0

# 激进模式下的仓位放大倍数
POSITION_SIZING_AGGRESSIVE_MULTIPLIER=1.5

# ========== 流动性/滑点保护配置 ==========

# 是否启用流动性保护（true/false）
POSITION_SIZING_LIQUIDITY_PROTECTION_ENABLED=true

# 单笔金额不超过盘口前 N 档的百分比（默认 20%）
# 这是 HFT 策略最重要的保护机制，防止大单吃穿盘口
POSITION_SIZING_LIQUIDITY_DEPTH_RATIO=0.20

# 监控盘口前 N 档深度（默认 3 档）
POSITION_SIZING_LIQUIDITY_DEPTH_LEVELS=3

# ========== 波动率保护配置 ==========

# 是否启用波动率保护（true/false）
POSITION_SIZING_VOLATILITY_PROTECTION_ENABLED=true

# 波动率 EMA 周期（用于计算价格波动率）
POSITION_SIZING_VOLATILITY_EMA_PERIOD=20

# 波动率阈值（百分比），超过此值会自动减小仓位
# 默认 0.1% = 0.001，防止在市场剧烈波动时下大单被止损误触
POSITION_SIZING_VOLATILITY_THRESHOLD=0.001

# ========== 追踪止损配置（ScalperV2 特有）==========
SCALPER_TRAILING_STOP_ACTIVATION_PCT=0.001
SCALPER_TRAILING_STOP_CALLBACK_PCT=0.0005

# ========== 执行算法配置 ==========
SCALPER_MAKER_TIMEOUT=3.0
SCALPER_ENABLE_CHASING=true
SCALPER_TICK_SIZE=0.01
SCALPER_MAX_CHASE_DISTANCE=0.001

# ========== 风控配置 ==========
RISK_PER_TRADE_PCT=0.01
MAX_ORDER_AMOUNT=50000.0
MAX_FREQUENCY=10

# ========== 🛡️ Guardian 熔断守护进程配置 ==========

# 是否启用熔断守护进程（true/false，默认 true）
GUARDIAN_ENABLED=true

# 检查间隔（秒），默认 5 秒
GUARDIAN_CHECK_INTERVAL_SECONDS=5

# 死循环检测阈值（次），默认 10000 次
# 如果任一事件类型在 5 秒内触发超过此次数，判定为死循环
GUARDIAN_EVENT_LOOP_THRESHOLD=10000

# 连续报错检测阈值（次），默认 20 次
# 如果相同错误消息在 5 秒内出现超过此次数，触发熔断
GUARDIAN_ERROR_LOG_THRESHOLD=20

# 严重错误检测阈值（条），默认 5 条
# 如果 CRITICAL 日志在 5 秒内超过此数量，触发熔断
GUARDIAN_CRITICAL_LOG_THRESHOLD=5

# 资金雪崩检测阈值（百分比），默认 0.10 (10%)
# 如果权益在 10 分钟内下降超过此百分比，触发熔断
GUARDIAN_EQUITY_DROP_THRESHOLD_PCT=0.10

# WebSocket 重连阈值（次），默认 30 次
# 如果 5 分钟内重连次数超过此数量，触发熔断
GUARDIAN_WS_RECONNECT_THRESHOLD=30

# 熔断时是否自动平仓（true/false，默认 false）
# 建议设置为 false，只取消订单，保留持仓
GUARDIAN_AUTO_CLOSE_ON_MELTDOWN=false

# 熔断快照保存路径（目录）
GUARDIAN_SNAPSHOT_PATH=data/meltdown_snapshots/

# ========== 交易方向配置 ==========
# both: 双向交易（做多+做空）
# long_only: 只做多
# short_only: 只做空
SCALPER_TRADE_DIRECTION=both

# ========== EMA 过滤配置 ==========
# strict: 严格过滤（做多必须Price>EMA，做空必须Price<EMA）
# loose: 宽松加权（顺势时仓位+20%，逆势时正常仓位）
# off: 关闭EMA过滤（纯失衡信号）
SCALPER_EMA_FILTER_MODE=loose

# EMA 顺势加权比例
# 当趋势与信号一致时，仓位乘以 (1 + boost_pct)
# 例如：0.20 表示顺势时仓位增加 20%
SCALPER_EMA_BOOST_PCT=0.20

# ========== EMA 参数 ==========
SCALPER_EMA_PERIOD=50
SCALPER_SPREAD_THRESHOLD_PCT=0.0005

# ========== 信号阈值（降低以捕获更多机会）==========
SCALPER_IMBALANCE_RATIO=3.0    # 买卖失衡比率阈值（降低到3.0）
SCALPER_MIN_FLOW=500.0         # 最小单笔成交量（USDT，降低到500）

# ========== 订单簿深度过滤配置 ==========
# 通过比较买卖盘口深度，过滤高风险信号
SCALPER_DEPTH_FILTER_ENABLED=true

# 做多阈值：bid_depth / ask_depth 必须 >= 此值
# 0.8 表示买方盘口至少是卖方的 80%，否则拒绝做多
SCALPER_DEPTH_RATIO_LOW=0.8

# 做空阈值：bid_depth / ask_depth 必须 <= 此值
# 1.25 表示买方盘口不能超过卖方的 125%，否则拒绝做空
SCALPER_DEPTH_RATIO_HIGH=1.25

# 深度计算档位数（前N档）
SCALPER_DEPTH_CHECK_LEVELS=3

# ========== Sniper 策略配置（如果使用）==========
ENABLE_SNIPER=false
SNIPER_CAPITAL=2000.0
SNIPER_POSITION_SIZE=0.1
SNIPER_COOLDOWN=5.0
SNIPER_ORDER_TYPE=market
SNIPER_MIN_BIG_ORDER=5000.0
