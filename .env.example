# Athena Trader 环境变量配置示例
# 复制此文件为 .env 并填写你的真实配置

# ========== 📋 基础配置 ==========
ACTIVE_STRATEGY=scalper_v2

# ========== 📝 日志配置 ==========

# 全局日志级别
# DEBUG: 详细调试信息
# INFO: 一般信息（推荐生产环境）
# WARNING: 警告信息
# ERROR: 错误信息
# CRITICAL: 严重错误
LOG_LEVEL=INFO

# Emoji 日志开关（true/false）
# true: 使用 emoji 增强可读性
# false: 使用简洁格式（适合日志分析工具）
LOG_USE_EMOJI=true

# 性能监控开关（用于调试）
# 生产环境建议关闭以提升性能（可节省 15-20ms）
# 开发环境可设为 true 以进行性能分析
EVENT_BUS_ENABLE_LATENCY_TRACKING=false

# 模块级别日志配置（覆盖全局设置）
# 生产环境建议：以下模块设为 WARNING 或 DEBUG 以减少日志输出 85-90%
POSITION_SIZER_LOG_LEVEL=WARNING
SIGNAL_GENERATOR_LOG_LEVEL=DEBUG
EVENT_BUS_LOG_LEVEL=WARNING
EXECUTION_ALGO_LOG_LEVEL=DEBUG
STRATEGY_LOG_LEVEL=INFO
GATEWAY_LOG_LEVEL=INFO
RISK_LOG_LEVEL=INFO
MARKET_DATA_MANAGER_LOG_LEVEL=INFO
STATE_MACHINE_LOG_LEVEL=INFO

# 详细日志开关（用于调试）
# 生产环境建议全部设为 false
POSITION_SIZER_VERBOSE=false
SIGNAL_GENERATOR_VERBOSE=false
EXECUTION_ALGO_VERBOSE=false
STATE_MACHINE_VERBOSE=false

# ========== 🛠️ 工具函数配置（新增 2026-02-07）==========

# 价格显示精度（小数位数）
# 默认 2，表示显示价格时保留 2 位小数
PRICE_DISPLAY_PRECISION=2

# 时间格式化配置
# 时间间隔显示格式：auto（自动选择单位）或 fixed（固定使用秒）
DURATION_FORMAT_MODE=auto

# 持仓盈亏计算精度（小数位数）
PNL_CALCULATION_PRECISION=2

# ========== 💉 依赖注入容器配置（新增 2026-02-07）==========

# 是否启用依赖注入容器（true/false）
# true: 使用 DI 容器管理组件依赖（推荐）
# false: 使用传统方式创建组件
CONTAINER_ENABLED=true

# 容器调试模式（true/false）
# true: 记录容器注册和获取的详细信息
# false: 只记录关键信息
CONTAINER_DEBUG=false

# ========== 🔄 状态机配置（新增 2026-02-07）==========

# 是否启用状态机日志（true/false）
STATE_MACHINE_LOG_ENABLED=true

# 状态转换详细日志（true/false）
# true: 记录每次状态转换的详细信息
# false: 只记录状态变化
STATE_MACHINE_LOG_TRANSITIONS=true

# ========== 📊 市场数据管理器配置（优化 2026-02-07）==========

# OrderBook 返回深度档数（默认 5 档）
# 建议值：3-5 档，减少数据传输量 60-80%
MARKET_DATA_ORDER_BOOK_DEPTH=5

# 是否启用订单簿深度过滤（true/false）
DEPTH_FILTER_ENABLED=true

# 做多深度比率阈值（默认 0.8）
# bid_depth / ask_depth >= 此值时允许做多
DEPTH_RATIO_THRESHOLD_LOW=0.8

# 做空深度比率阈值（默认 1.25）
# bid_depth / ask_depth <= 此值时允许做空
DEPTH_RATIO_THRESHOLD_HIGH=1.25

# 深度检查档位数（默认 3 档）
DEPTH_CHECK_LEVELS=3

# ========== 💰 资金配置 ==========
TOTAL_CAPITAL=10000.0
SCALPER_CAPITAL=10000.0

# ========== 🪙 交易对配置 ==========
TRADING_SYMBOL=DOGE-USDT-SWAP
SCALPER_SYMBOL=DOGE-USDT-SWAP

# ========== 🔑 OKX API 配置 ==========
OKX_API_KEY=your_api_key_here
OKX_SECRET_KEY=your_secret_key_here
OKX_PASSPHRASE=your_passphrase_here

# ========== 🎮 模拟交易配置 ==========
USE_DEMO=true

# ========== 📈 ScalperV2 策略配置（当前唯一支持的策略）==========

# ========== 基础策略参数 ==========
ENABLE_SCALPER_V2=true
SCALPER_TAKE_PROFIT_PCT=0.002
SCALPER_STOP_LOSS_PCT=0.01
SCALPER_TIME_LIMIT_SECONDS=30
SCALPER_COOLDOWN_SECONDS=0.1
SCALPER_LEVERAGE=5.0

# ========== 自适应仓位管理配置 ==========

# 基础资金配置
# 基础仓位：总资金的百分比（默认 2%）
POSITION_SIZING_BASE_EQUITY_RATIO=0.02

# 最大杠杆倍数限制
POSITION_SIZING_MAX_LEVERAGE=5.0

# 最小下单金额（USDT），低于此值不会下单
POSITION_SIZING_MIN_ORDER_VALUE=10.0

# ========== 信号强度自适应配置 ==========

# 是否启用信号强度自适应（true/false）
POSITION_SIZING_SIGNAL_SCALING_ENABLED=true

# 正常不平衡阈值（倍数），达到此值使用 1.0 倍仓位
POSITION_SIZING_SIGNAL_THRESHOLD_NORMAL=5.0

# 激进不平衡阈值（倍数），达到此值使用 1.5 倍仓位
POSITION_SIZING_SIGNAL_THRESHOLD_AGGRESSIVE=10.0

# 激进模式下的仓位放大倍数
POSITION_SIZING_AGGRESSIVE_MULTIPLIER=1.5

# ========== 流动性/滑点保护配置 ==========

# 是否启用流动性保护（true/false）
POSITION_SIZING_LIQUIDITY_PROTECTION_ENABLED=true

# 单笔金额不超过盘口前 N 档的百分比（默认 20%）
# 这是 HFT 策略最重要的保护机制，防止大单吃穿盘口
POSITION_SIZING_LIQUIDITY_DEPTH_RATIO=0.20

# 监控盘口前 N 档深度（默认 3 档）
POSITION_SIZING_LIQUIDITY_DEPTH_LEVELS=3

# ========== 波动率保护配置 ==========

# 是否启用波动率保护（true/false）
POSITION_SIZING_VOLATILITY_PROTECTION_ENABLED=true

# 波动率 EMA 周期（用于计算价格波动率）
POSITION_SIZING_VOLATILITY_EMA_PERIOD=20

# 波动率阈值（百分比），超过此值会自动减小仓位
# 默认 0.1% = 0.001，防止在市场剧烈波动时下大单被止损误触
POSITION_SIZING_VOLATILITY_THRESHOLD=0.001

# ========== 追踪止损配置 ==========
SCALPER_TRAILING_STOP_ACTIVATION_PCT=0.001
SCALPER_TRAILING_STOP_CALLBACK_PCT=0.0005

# ========== 执行算法配置 ==========
SCALPER_MAKER_TIMEOUT=3.0
SCALPER_ENABLE_CHASING=true
SCALPER_TICK_SIZE=0.01
SCALPER_MAX_CHASE_DISTANCE=0.001

# ========== 🛡️ 风控配置 ==========
RISK_PER_TRADE_PCT=0.01
MAX_ORDER_AMOUNT=50000.0
MAX_FREQUENCY=10

# ========== 🛡️ Guardian 熔断守护进程配置 ==========

# 是否启用熔断守护进程（true/false，默认 true）
GUARDIAN_ENABLED=true

# 检查间隔（秒），默认 5 秒
GUARDIAN_CHECK_INTERVAL_SECONDS=5

# 死循环检测阈值（次），默认 10000 次
# 如果任一事件类型在 5 秒内触发超过此次数，判定为死循环
GUARDIAN_EVENT_LOOP_THRESHOLD=10000

# 连续报错检测阈值（次），默认 20 次
# 如果相同错误消息在 5 秒内出现超过此次数，触发熔断
GUARDIAN_ERROR_LOG_THRESHOLD=20

# 严重错误检测阈值（条），默认 5 条
# 如果 CRITICAL 日志在 5 秒内超过此数量，触发熔断
GUARDIAN_CRITICAL_LOG_THRESHOLD=5

# 资金雪崩检测阈值（百分比），默认 0.10 (10%)
# 如果权益在 10 分钟内下降超过此百分比，触发熔断
GUARDIAN_EQUITY_DROP_THRESHOLD_PCT=0.10

# WebSocket 重连阈值（次），默认 30 次
# 如果 5 分钟内重连次数超过此数量，触发熔断
GUARDIAN_WS_RECONNECT_THRESHOLD=30

# 熔断时是否自动平仓（true/false，默认 false）
# 建议设置为 false，只取消订单，保留持仓
GUARDIAN_AUTO_CLOSE_ON_MELTDOWN=false

# 熔断快照保存路径（目录）
GUARDIAN_SNAPSHOT_PATH=data/meltdown_snapshots/

# ========== 交易方向配置 ==========
# both: 双向交易（做多+做空）
# long_only: 只做多
# short_only: 只做空
SCALPER_TRADE_DIRECTION=both

# ========== EMA 过滤配置 ==========
# strict: 严格过滤（做多必须Price>EMA，做空必须Price<EMA）
# loose: 宽松加权（顺势时仓位+20%，逆势时正常仓位）
# off: 关闭EMA过滤（纯失衡信号）
SCALPER_EMA_FILTER_MODE=loose

# EMA 顺势加权比例
# 当趋势与信号一致时，仓位乘以 (1 + boost_pct)
# 例如：0.20 表示顺势时仓位增加 20%
SCALPER_EMA_BOOST_PCT=0.20

# ========== EMA 参数 ==========
SCALPER_EMA_PERIOD=50
SCALPER_SPREAD_THRESHOLD_PCT=0.0005

# ========== 信号阈值（降低以捕获更多机会）==========
SCALPER_IMBALANCE_RATIO=3.0    # 买卖失衡比率阈值（降低到3.0）
SCALPER_MIN_FLOW=500.0         # 最小单笔成交量（USDT，降低到500）

# ========== 🔧 高级配置 ==========
# WebSocket 心跳间隔（秒）
WS_HEARTBEAT_INTERVAL=25

# WebSocket 看门狗超时（秒）
WS_WATCHDOG_TIMEOUT=60

# 持仓同步间隔（秒）
POSITION_SYNC_INTERVAL=30

# 订单查询超时（秒）
ORDER_QUERY_TIMEOUT=10

# 持仓对账超时（秒）
POSITION_RECONCILIATION_TIMEOUT=5

# ========== 🧪 测试配置 ==========
# 是否启用测试模式
TEST_MODE=false

# 测试用数据路径
TEST_DATA_PATH=data/test/

# ========== 📊 监控配置 ==========
# 是否启用性能监控
ENABLE_PERFORMANCE_MONITORING=true

# 性能监控间隔（秒）
PERFORMANCE_MONITORING_INTERVAL=60

# 是否启用内存监控
ENABLE_MEMORY_MONITORING=true

# 内存监控间隔（秒）
MEMORY_MONITORING_INTERVAL=120

# ========== 🚨 告警配置 ==========
# 是否启用告警
ENABLE_ALERTS=false

# 告警 Webhook URL（可选）
ALERT_WEBHOOK_URL=

# 告警 Email（可选）
ALERT_EMAIL=

# ========== 📝 其他配置 ==========

# 项目版本
PROJECT_VERSION=3.3

# 项目名称
PROJECT_NAME=AthenaTrader

# 交易所名称
EXCHANGE_NAME=OKX

# 网络超时（秒）
NETWORK_TIMEOUT=30

# 最大重试次数
MAX_RETRIES=3

# 重试间隔（秒）
RETRY_INTERVAL=1
